Q Function apps vs App Services?

Azure App Service â†’ Always-on web application hosting (APIs, MVC, Web Apps)

Azure Functions â†’ Event-driven, serverless execution (run code only when triggered)

| Aspect        | App Service                    | Azure Functions          |
| ------------- | ------------------------------ | ------------------------ |
| Runtime       | Always running                 | Runs only when triggered |
| Startup       | App starts once and stays warm | Cold start possible      |
| Trigger-based | âŒ No                           | âœ… Yes                    |
| Event-driven  | âŒ                              | âœ…                        |


------------------------------------------------------------------------
Q Type of Identities, System based Identify, Managed Identify and User Identify

1. System-Assigned Managed Identity

| Feature   | Description                |
| --------- | -------------------------- |
| Lifecycle | Tied to the resource       |
| Created   | Automatically when enabled |
| Deleted   | When resource is deleted   |
| Reusable  | âŒ No                       |
| Scope     | One identity per resource  |

2. User-Assigned Managed Identity (UAMI)
| Feature   | Description                |
| --------- | -------------------------- |
| Lifecycle | Independent Azure resource |
| Created   | Manually                   |
| Deleted   | Separately                 |
| Reusable  | âœ… Yes                      |
| Shareable | Across multiple services   |


-----------------------------------------------------------------------------------------

Q   I have a .NET Web API I want to consume SQL Server and I want to Consume Blob Storage, In Azure how the integration looks like
ASP.NET Core Web API â†’ Hosted on Azure App Service

Azure SQL Database

Azure Blob Storage

Managed Identity (System-assigned or User-assigned)

Private Endpoints + VNET

use managed or System assigned identity

Azure SQL Integration:
  Grant DB access to Managed Identity
  
  CREATE USER [my-app-mi] FROM EXTERNAL PROVIDER;
  
ALTER ROLE db_datareader ADD MEMBER [my-app-mi];
ALTER ROLE db_datawriter ADD MEMBER [my-app-mi];

"ConnectionStrings": {
  "SqlDb": "Server=tcp:myserver.database.windows.net,1433;Database=MyDb;Authentication=Active Directory Managed Identity;"
}
----------------------------------------------------------------------------

Q can we use windows auth based sql connection string in azure VM?

Yes, Windows Authentication works from an Azure VM only if the VM and SQL Server are joined to the same 
Active Directory (or trusted domains).


----------------------------------------------------------------------

Q can we use windows auth based sql connection string in azure App service
No â€” Azure App Service does NOT support traditional Windows Authentication (Integrated Security / Trusted_Connection) to SQL Server.



-------------------------------------------------------


Q I have a background job which is recurring, what are the different ways to Do, for daily notifications Web Jobs

1 Azure Functions (RECOMMENDED)
2 Logic Apps are suitable when orchestration is needed with minimal code.
3 App Service web jobs

BackgroundService does NOT run on the same thread as the request thread.
It runs on separate ThreadPool threads, but inside the same process.

----------------------------------------------


Q Can I do 2 webjgbs in same app Service Plan?
Yes âœ… â€” you can run multiple WebJobs in the same App Service Plan.
In fact, this is very common.

App Service Plan (Compute)
   â”œâ”€â”€ App Service (Web API / Web App)
   â”‚     â”œâ”€â”€ WebJob #1
   â”‚     â”œâ”€â”€ WebJob #2
   â”‚     â””â”€â”€ WebJob #3
   â”‚
   â””â”€â”€ App Service (Another App)
         â”œâ”€â”€ WebJob A
         â””â”€â”€ WebJob B

----------------------------------------------

Q What are the things Azure app service web job can do but function app cannot do?

1. Deploy Alongside Web Application
WebJobs can be deployed as part of an App Service, sharing the same resources and plan with your web app.


2. True Continuous Background Processing
WebJobs can run as always-on continuous processes with full control over the execution loop.

// WebJob runs continuously with your own loop
public class Program
{
    static async Task Main()
    {
        // Runs forever until stopped
        while (true)
        {
            try
            {
                // Your custom logic
                await ProcessMessages();
                await Task.Delay(TimeSpan.FromSeconds(10));
            }
            catch (Exception ex)
            {
                // Handle errors, don't crash
                Console.WriteLine($"Error: {ex.Message}");
            }
        }
    }
}

3 3. Shared File System Access
WebJobs have direct, persistent access to the App Service file system, shared with the web app.

-------------------------------------------


Q How will you decide I need a separate App Service Plan, looking at scalability or availability?

Create a separate App Service Plan when workloads must scale or fail independently.

A Scalability Factors
Resource isolation needs - If your applications have significantly different resource consumption patterns (CPU, memory),
separating them prevents one app from starving another of resources.

Independent scaling requirements - When apps need to scale at different rates or times,
 separate plans make sense. Your API might need to scale out during business hours while your admin portal remains small. With separate plans, you can configure autoscaling rules independently.
 
Availability Factors
Blast radius containment - Separate plans isolate failures. If one app crashes and exhausts resources, 
it won't affect apps in other plans. This is critical for production workloads with different SLAs.




----------------------------------------------------------------------

Q I am using the single Topic in SB and multiple subscriber, 
I want to trigger based on a Field as the parameters in Topics are same how would I achieve that?

Publisher
   â†“
Service Bus Topic
   â”œâ”€â”€ Subscription A (Filter: Type = 'Email')
   â”œâ”€â”€ Subscription B (Filter: Type = 'SMS')
   â””â”€â”€ Subscription C (Filter: Type = 'Push')


Your message must include a custom property (NOT just body).

var message = new ServiceBusMessage(jsonPayload);
message.ApplicationProperties["NotificationType"] = "Email";

await sender.SendMessageAsync(message);

ğŸ“Œ Filters work ONLY on message properties, not body.


--------------------------------------------------------------


Q If you read the queue, how should we process at code level, 
how ServiceBusQueue class works, DeadLetter Queue or some other concepts in SB works at Code level, explain?

processor.ProcessMessageAsync += async args =>
{
    try
    {
        var body = args.Message.Body.ToString();

        // 1ï¸âƒ£ Business logic
        await ProcessOrder(body);

        // 2ï¸âƒ£ Explicit success
        await args.CompleteMessageAsync(args.Message);
    }
    catch (Exception ex)
    {
        // 3ï¸âƒ£ Failure handling
        await args.AbandonMessageAsync(args.Message);
    }
};

Dead-Letter Queue (DLQ) â€“ Explained Properly
| Reason                             | Who does it |
| ---------------------------------- | ----------- |
| `DeliveryCount > MaxDeliveryCount` | Service Bus |
| Invalid format                     | Your code   |
| Business rule failure              | Your code   |
| TTL expired                        | Service Bus |

// Dead-lettering Manually (Best Practice)
await args.DeadLetterMessageAsync(
    args.Message,
    "ValidationFailed",
    "Order amount is invalid");
	
Without DLQ:

Same bad message retries infinitely	


Sessions (Advanced but Common Question)
When order matters
Use Sessions
 Messages with same SessionId go to same consumer
 FIFO guaranteed per session

message.SessionId = orderId;

---------------------------------------------

Q how many ways you can trigger the Service Bus explain

Pull-Based Trigger 
1 ServiceBusProcessor


Push based
Azure Functions listens to:

Queue

Topic Subscription

Triggered automatically when message arrives


or manual


-----------------------------------------------

Q I have an Azure Function App deployed or hosted in App Service Plan having three instances.
 There is a function in Function App which is time triggered. Since function is deployed on App
 Service Plan having three instances, so during trigger time, will it trigger for one time or for three times?
 
 A Timer-triggered Azure Function runs ONLY ONCE per schedule,
even if your Function App is running on multiple instances.

Azure Functions uses a distributed lock (based on Azure Storage) to ensure that only one instance executes the timer trigger.

Instance 1 â†’ tries to acquire timer lock
Instance 2 â†’ tries to acquire timer lock
Instance 3 â†’ tries to acquire timer lock

âœ” Only ONE instance acquires the lock
âŒ Others skip execution

---------------------------------------------------------

Q what is OCI images?

OCI (Open Container Initiative) is an open governance structure for creating industry standards around container formats and runtimes.
It was established in 2015 by Docker and other industry leaders.
OCI Image = Standardized container image format
          = Works across different container platforms
          = Not locked to Docker
		  
		  
-------------------------------------------------------		  

Q ACR - what is use of it and explain 

Azure Container Registry (ACR) is a private Docker/OCI image registry in Azure.
It stores and manages container images (and Helm/OCI artifacts) that your apps run.

Think of it as Azureâ€™s secure, enterprise-grade alternative to Docker Hub.


What do we store in ACR?

Docker images

OCI images

Helm charts (OCI-based) # imp

Image layers & tags


--------------------------------------------------------------------------------

Q If I biuld an image using docker and tries to run in k8s pod having containerd runtime. Will it work?

YES

Docker produces OCI-compliant images (since 2017)

Your Development Machine          Kubernetes Cluster
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Docker Desktop    â”‚          â”‚    Kubernetes Node   â”‚
â”‚                     â”‚          â”‚                      â”‚
â”‚  docker build       â”‚          â”‚   kubelet            â”‚
â”‚       â†“             â”‚          â”‚      â†“               â”‚
â”‚  OCI Image          â”‚  â”€pushâ†’  â”‚  containerd (CRI)    â”‚
â”‚       â†“             â”‚          â”‚      â†“               â”‚
â”‚  Registry (ACR/ECR) â”‚          â”‚  OCI Image (pulled)  â”‚
â”‚                     â”‚          â”‚      â†“               â”‚
â”‚                     â”‚          â”‚  Running Container   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


-----------------------------------------------------------

Q Helm Charts - What do Helm Chart do. Why do we need?

Helm is the package manager for Kubernetes.
A Helm Chart is a reusable, configurable package of Kubernetes manifests.

If Kubernetes YAMLs are raw files, Helm Charts are templates + values + versioning.
A Helm Chart lets you:

Package multiple Kubernetes YAMLs
Template them using variables
Configure them per environment
Install / upgrade / rollback apps easily

Reuse the same deployment logic

âŒ Without Helm (pain points)

Duplicate YAML files per environment

Manual edits for:

image name

replicas

resources

URLs

No versioning

No rollback

Hard to maintain microservices


my-app/
â”œâ”€â”€ Chart.yaml        # Metadata (name, version)
â”œâ”€â”€ values.yaml       # Default values
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ service.yaml
â”‚   â””â”€â”€ ingress.yaml




------------------------------------------------------------------

Helm chart example?


orders-api/
â”œâ”€â”€ Chart.yaml
â”œâ”€â”€ values.yaml
â”œâ”€â”€ values-dev.yaml
â”œâ”€â”€ values-prod.yaml
â””â”€â”€ templates/
    â”œâ”€â”€ deployment.yaml
    â”œâ”€â”€ service.yaml
    â”œâ”€â”€ ingress.yaml
    â””â”€â”€ _helpers.tpl



1 chart.yml

apiVersion: v2
name: orders-api
description: Helm chart for Orders ASP.NET Core Web API
type: application
version: 0.1.0           # Chart version
appVersion: "1.0.0"      # App version



2 values.yaml

replicaCount: 2

image:
  repository: myacr.azurecr.io/orders-api
  tag: v1
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 80

resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "500m"
    memory: "512Mi"

ingress:
  enabled: true
  className: nginx
  host: orders.local
  path: /





3 values-dev.yaml

replicaCount: 1

image:
  tag: dev

ingress:
  host: orders-dev.local




4  values-prod.yaml
replicaCount: 4

image:
  tag: prod

resources:
  requests:
    cpu: "500m"
    memory: "512Mi"
  limits:
    cpu: "1"
    memory: "1Gi"

ingress:
  host: orders.mycompany.com



5 _helpers.tpl

{{- define "orders-api.name" -}}
orders-api
{{- end }}

{{- define "orders-api.fullname" -}}
{{ .Release.Name }}-orders-api
{{- end }}



6 deployment.yaml

apiVersion: apps/v1
kind: Deployment
metadata:
  name: {{ include "orders-api.fullname" . }}
spec:
  replicas: {{ .Values.replicaCount }}
  selector:
    matchLabels:
      app: {{ include "orders-api.name" . }}
  template:
    metadata:
      labels:
        app: {{ include "orders-api.name" . }}
    spec:
      containers:
        - name: orders-api
          image: "{{ .Values.image.repository }}:{{ .Values.image.tag }}"
          imagePullPolicy: {{ .Values.image.pullPolicy }}
          ports:
            - containerPort: 80
          resources:
            requests:
              cpu: {{ .Values.resources.requests.cpu }}
              memory: {{ .Values.resources.requests.memory }}
            limits:
              cpu: {{ .Values.resources.limits.cpu }}
              memory: {{ .Values.resources.limits.memory }}


7 service.yaml

apiVersion: v1
kind: Service
metadata:
  name: {{ include "orders-api.fullname" . }}
spec:
  type: {{ .Values.service.type }}
  selector:
    app: {{ include "orders-api.name" . }}
  ports:
    - port: {{ .Values.service.port }}
      targetPort: 80


8 ingress.yaml

{{- if .Values.ingress.enabled }}
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: {{ include "orders-api.fullname" . }}
spec:
  ingressClassName: {{ .Values.ingress.className }}
  rules:
    - host: {{ .Values.ingress.host }}
      http:
        paths:
          - path: {{ .Values.ingress.path }}
            pathType: Prefix
            backend:
              service:
                name: {{ include "orders-api.fullname" . }}
                port:
                  number: {{ .Values.service.port }}
{{- end }}


helm install orders-dev ./orders-api -f values-dev.yaml


helm install orders-prod ./orders-api -f values-prod.yaml

---------------------------------------------------------------

Q What CLI you use to test HelmChart in Local machine - Is it with Doctor or something else?

Helm charts are tested locally using helm lint for validation and helm template or 
helm install --dry-run to render and verify the generated Kubernetes manifests.
Helm does not have a doctor command.

Primary CLI Commands to Test Helm Charts Locally
Checks:

Chart structure

YAML syntax

Template errors

Best-practice warnings

helm lint ./orders-api

Think of it as static validation


helm template (Dry-run Render)
helm template orders ./orders-api
or 
helm template orders ./orders-api -f values-dev.yaml



-------------------------------------------------

Q How will you handle the CORS Issues?

builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowedOrigins", policy =>
    {
        policy
            .WithOrigins(
                "https://myfrontend.com",
                "https://admin.myfrontend.com"
            )
            .AllowAnyHeader()
            .AllowAnyMethod()
            .AllowCredentials(); // only if cookies / auth headers used
    });
});


app.UseCors("AllowedOrigins");   // MUST be before auth # imp

app.UseAuthentication();
app.UseAuthorization();


Controller-level

[EnableCors("AllowedOrigins")] #imp
[ApiController]
public class OrdersController : ControllerBase
{
}


CORS in Azure (Important)
ğŸ”¹ App Service

CORS can be set:

In code (recommended)

Or Azure Portal (less flexible)

âš ï¸ Portal CORS applies before app code and can conflict.


API Management (APIM)

CORS should be handled:

At APIM layer (preferred)

Or backend API (not both)


<cors>
  <allowed-origins>
    <origin>https://myfrontend.com</origin>
  </allowed-origins>
  <allowed-methods>
    <method>*</method>
  </allowed-methods>
</cors>

---------------------------------------------------------

Q What are the different types of CORS policies in ASP.NET Core?

1ï¸âƒ£ Default (Global) CORS Policy

This policy is applied globally to all controllers/endpoints.

builder.Services.AddCors(options =>
{
    options.AddDefaultPolicy(policy =>
    {
        policy
            .WithOrigins("https://example.com")
            .AllowAnyHeader()
            .AllowAnyMethod();
    });
});

app.UseCors(); // uses default policy


2ï¸âƒ£ Named CORS Policies

You can define multiple policies and apply them selectively.

builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowFrontend", policy =>
    {
        policy.WithOrigins("https://frontend.com")
              .AllowAnyHeader()
              .AllowAnyMethod();
    });

    options.AddPolicy("AllowAdmin", policy =>
    {
        policy.WithOrigins("https://admin.frontend.com")
              .AllowAnyHeader()
              .AllowAnyMethod();
    });
});

Apply at middleware level
app.UseCors("AllowFrontend");

Apply at controller/action level

[EnableCors("AllowAdmin")]
public class AdminController : ControllerBase
{
}


3ï¸âƒ£ Attribute-Based CORS Policy

Applied directly on controller or action methods.
Disable CORS for specific endpoints
[DisableCors]
public IActionResult InternalEndpoint()
{
    return Ok();
}

4ï¸âƒ£ Restricted / Secure CORS Policy (Recommended)
Used for production-grade APIs.

options.AddPolicy("SecurePolicy", policy =>
{
    policy.WithOrigins("https://myapp.com")
          .WithMethods("GET", "POST")
          .WithHeaders("Content-Type", "Authorization")
          .AllowCredentials();
});

5ï¸âƒ£ Environment-Based CORS Policies (Best Practice)

if (app.Environment.IsDevelopment())
{
    app.UseCors("AllowAll");
}
else
{
    app.UseCors("SecurePolicy");
}

------------------------------------------------------

API End point is consumed by Multiple Applications, How do you manage?
1 Use token-based authentication

OAuth 2.0 / OpenID Connect

JWT tokens

2 use API gateway
 never exponse backend endpoint
 
3. Versioning Strategy (NON-NEGOTIABLE)

You cannot avoid versioning. 


4 Rate Limiting & Throttling (Protect Yourself)




-------------------------------------------------
Q I donâ€™t want to write code but I want to validate each request - how can I do in APIM


1. JWT / OAuth Validation (VERY COMMON)
2. Header Validation (API Key, Custom Headers)
3. Query Parameter Validation
4. Request Body Schema Validation
5. Rate Limiting (Protect Backend)
<rate-limit calls="100" renewal-period="60" />

6. Quota (Long-term Limits)
<quota calls="10000" renewal-period="2592000" />
10,000 calls per month

7. IP Whitelisting / Blacklisting



------------------------------------------------------

Q How Middleware Executes in a scenario of API Execution to check the Authentication and Authorisation before hitting the Web API?


HTTP Request
   â†“
Kestrel
   â†“
Middleware Pipeline
   â†“
Routing
   â†“
Authentication
   â†“
Authorization
   â†“
Endpoint Execution (Controller / Action)
   â†“
Response


var app = builder.Build();

app.UseRouting();              // 1ï¸âƒ£ Match route

app.UseAuthentication();       // 2ï¸âƒ£ Who are you?
app.UseAuthorization();        // 3ï¸âƒ£ Are you allowed?

app.MapControllers();          // 4ï¸âƒ£ Execute API



public class MyMiddleware
{
  public MyMiddleware(RequestDelagate next)
  {
  
  }
  
  
  public async Task InvokeAsync(HttpContext httpCOntext , IPayloadTracker tracker)
  {
     await next(httpCOntext);
  }
}

-------------------------------------------------------

Q what are the different hosting models in .net

A. Kestrel (Cross-Platform Web Server)
Default and recommended web server for ASP.NET Core.

// Program.cs (.NET 6+)
var builder = WebApplication.CreateBuilder(args);
var app = builder.Build();

app.MapGet("/", () => "Hello World!");

app.Run();  // Runs on Kestrel by default
// Default: http://localhost:5000

# Production (behind nginx/Apache)
nginx â†’ Kestrel (ASP.NET Core app)


B. IIS (Internet Information Services)
Windows-only web server with two hosting models:
In-Process Hosting (Recommended for IIS)

// In-process: App runs inside IIS worker process (w3wp.exe)
builder.WebHost.UseIIS();  // Optional, auto-configured

Out-of-Process Hosting

// Explicitly specify out-of-process
builder.WebHost.UseIISIntegration();
```

**Architecture:**
```
Internet â†’ IIS (w3wp.exe) â†’ ASP.NET Core Module
                â†“
        Reverse proxy to
                â†“
        Kestrel (separate process)
        (App runs separately)


Aspect             In-Process             Out-of-Process
Performance         â­â­â­â­â­ Faster            â­â­â­â­ Good
Process             w3wp.exe                dotnet.exe
Complexity           Simple                 More complex
Isolation            Less isolated          More isolated
Recommended         âœ… Yes (IIS)            For special cases

-----------------------------------------------------

Q I have asp .net web api

var builder = WebApplication.CreateBuilder(args);
 builder.Build();

having this code deployed in Azure app service (windows based). What is be the hosting model?

You can change the hosting model by setting the <AspNetCoreHostingModel> in the project file to OutOfProcess.

In .NET 6 and later, the default hosting model for an ASP.NET Core app running in IIS or Azure App Service (Windows) is in-process.

Azure App Service on Windows uses IIS as the reverse proxy
The platform automatically handles the hosting model based on your application
Most modern ASP.NET Core apps use in-process for better performance
You can verify this in the Azure Portal under App Service logs or process explorer

When you deploy this to Azure App Service (Windows):
Your app runs inside an IIS worker process (w3wp.exe).
IIS acts as a reverse proxy to your ASP.NET Core app.
The actual request pipeline is handled by Kestrel, but IIS forwards the traffic to it.
This setup is called the In-Process hosting model for ASP.NET Core on Windows App Service.

----------------------------------------------------------


 Q  Can we use Async without await ?

Yes â€” you can use async without await, but you almost never should.

public async Task DoWork()
{
    Console.WriteLine("Hello");
}

Runtime behavior

Runs synchronously

No thread switching

No async benefit

Extra overhead (state machine created)


------------------------


Q async void vs async Task?


async Task (Correct & Safe)
public async Task ProcessOrderAsync()
{
    await SaveToDbAsync();
    await SendEmailAsync();
}

await ProcessOrderAsync(); // safe


async void (Dangerous)

public async void ProcessOrder()
{
    await SaveToDbAsync();
    throw new Exception("Boom");
}

What happens?

Caller cannot await

Exception is unhandled

App may crash

Problems

No way to know when it finishes

No way to catch exceptions

No retry / resilience

Breaks reliability

The ONLY Valid Use of async void is Event Handlers
button.Click += async (sender, e) =>
{
    await LoadDataAsync();
};

------------------------------------------

Q What is the concept of concurrent list and normal list?

List<int> numbers = new List<int>();
Key properties

âŒ Not thread-safe

Designed for single-threaded or read-only scenarios

Fast in single-threaded use

What goes wrong in multithreading
Parallel.For(0, 1000, i =>
{
    numbers.Add(i); // âŒ race condition
});


Since there is no ConcurrentList<T>, concurrency is handled in two ways:

Option 1: Locking a Normal List (Manual Thread Safety)
List<int> numbers = new List<int>();
object _lock = new object();

Parallel.For(0, 1000, i =>
{
    lock (_lock)
    {
        numbers.Add(i);
    }
});

âœ… Option 2: Use .NET Concurrent Collections (Recommended)

Common concurrent collections
Collection	                            Use case
ConcurrentBag<T>	                    Unordered add/remove
ConcurrentQueue<T>	                    FIFO processing
ConcurrentStack<T>	                    LIFO processing
ConcurrentDictionary<TKey,TValue>	    Key-value storage


------------------------------------------------------------------------------


Q Different between .Result vs ConfigureAwait  
.Result blocks a thread.
ConfigureAwait(false) controls where the continuation runs

var data = GetDataAsync().Result;
Blocks the current thread

Waits synchronously for the async operation to finish

Converts async â†’ sync

--------------------------------------------------------------------------


Q  ConfigureAwait(false) vs ConfigureAwait(true)?

ConfigureAwait(true) is the default behavior and captures the current synchronization context so 
the continuation resumes on the same thread or context.

ConfigureAwait(false) prevents context capture and allows the continuation to run on any thread, 
improving performance and avoiding deadlocks.

IMP
In ASP.NET Core, both behave the same because there is no synchronization context.



-----------------------------------------------------------------------------------
-----------------------------------------------------------------------------------

Q If want to connect to SQL what are all the possible approaches are there. ADO.NET, ORM Frameworks etc..

How to connect?
connnection string
  1 passowrd based
  2 windows authentication
  3 managed indentity (Authentication=Active Directory Managed Identity)
  
  
  
| Approach | Abstraction | Performance | Productivity |
| -------- | ----------- | ----------- | ------------ |
| ADO.NET  | Low         | â­â­â­â­â­       | â­            |
| Dapper   | Medium      | â­â­â­â­        | â­â­â­          |
| EF Core  | High        | â­â­â­         | â­â­â­â­â­        |
| Hybrid   | Mixed       | â­â­â­â­        | â­â­â­â­         |
 

| Requirement          | Choose                |
| -------------------- | --------------------- |
| Maximum performance  | ADO.NET / Dapper      |
| Rapid development    | EF Core               |
| Complex reporting    | Dapper                |
| Large enterprise app | EF + Dapper           |
| Legacy DB            | Stored Procs + Dapper |

 
EF Core still allows raw SQL. 

we can use FromSqlRaw(query)


var orders = _dbContext.Orders
    .FromSqlRaw("EXEC GetOrders")
    .ToList();


---------------------------------------------------------

Q what is connection polling
Connection pooling is a mechanism where database connections are reused instead of being created and destroyed for every request.

Opening a DB connection is expensive:

Network handshake
Authentication
Session setup

Without pooling:
Request â†’ Open connection â†’ Query â†’ Close connection
âŒ Slow
âŒ High DB load
âŒ Poor scalability


With pooling:
Request â†’ Get connection from pool â†’ Query â†’ Return to pool

3ï¸âƒ£ How Connection Pooling Works (Internals)

App starts

First request opens a connection

Connection is stored in pool

Next request reuses it

Close() returns it to pool (does NOT destroy it)

In .NET, ADO.NET enables pooling by default, and calling Close or 
Dispose returns the connection to the pool rather than closing it physically.


------------------------------------------------------------

Q How do we scale the database when the application is scaling
You never â€œauto-scaleâ€ a database the same way you scale an app.
You choose vertical scaling + read scaling + data partitioning based on workload.

1 Scale UP (Vertical Scaling) â€“ Easiest & Most Common

2 Scale OUT for Reads (Read Replicas)
What it means

One write primary

Multiple read replicas

Azure SQL Options

A Azure SQL Read Replicas

B Geo-replication

C Failover Groups


3 Sharding (Horizontal Data Partitioning)
What it means

Split data across multiple databases.
Orders_1 â†’ CustomerId 1â€“10000
Orders_2 â†’ CustomerId 10001â€“20000


4 Connection Pooling (Often Forgotten)

Scaling apps increases:

Concurrent DB connections

Solution

Connection pooling (enabled by default)

Limit max pool size

Avoid connection leaks


"Max Pool Size=100;"

5 caching


6 CQRS Pattern (Advanced but Powerful)
Writes â†’ OLTP DB
Reads  â†’ Read-optimized DB / Cache


----------------------------------------------------------------------

Q While doing the load testing we simulate the Pooling what type of issues we will face mostly


What happens
All connections in the pool are busy
New requests wait for a free connection
Eventually â†’ timeout

Symptoms
Requests hang
Errors like:
  Timeout expired. The timeout period elapsed prior to obtaining a connection from the pool.


Pool size must be planned with scale-out in mind

1 Connection Leaks (Deadly in Load Tests)

What happens
Connections are never returned to pool
Pool shrinks over time
App works initially â†’ then dies

Causes
Missing Dispose
Exception paths not closing connection
Manually managing connections

Load test behavior
Test passes for 5â€“10 minutes
Suddenly everything fails


2 DB Connection Limit Reached (Azure SQL / SQL Server)
What happens

DB has max connection limit

App pool requests are rejected


3 Locking & Blocking in Database ğŸ”’
What happens

Queries block each other

Connections stay busy


-----------------------------------------

Q IEnumerable or IQueryable - what is the difference between and when to use

IEnumerable executes queries in memory.
IQueryable translates queries and executes them at the data source (e.g., SQL).

| Interface        | Where filtering happens     |
| ---------------- | --------------------------- |
| `IEnumerable<T>` | In application memory       |
| `IQueryable<T>`  | In database / remote source |



| Scenario             | Better        |
| -------------------- | ------------- |
| Large data set       | `IQueryable`  |
| DB-backed source     | `IQueryable`  |
| In-memory collection | `IEnumerable` |
| Custom C# logic      | `IEnumerable` |



| Interface     | Uses             |
| ------------- | ---------------- |
| `IQueryable`  | Expression Trees |
| `IEnumerable` | Delegates        |


----------------------------------------------------------------

Q Can we use IQuerable on inmemory collections

ye Via AsQueryable() but you usually should NOT.




----------------------------------------------------------------

Q Scaler Functions - explain the scenario/

Scalar functions in SQL Server are functions that return a single value (not a table) based on input parameters.
 They can be used anywhere you'd use an expression.
 
string: LEN(), UPPER(), LOWER(), SUBSTRING(), TRIM()

Date functions: GETDATE(), DATEADD(), DATEDIFF(), YEAR(), MONTH()

Math functions: ABS(), ROUND(), CEILING(), FLOOR(), POWER()

Conversion functions: CAST(), CONVERT(), TRY_PARSE()


CREATE FUNCTION dbo.CalculateTax (@Amount DECIMAL(10,2))
RETURNS DECIMAL(10,2)
AS
BEGIN
    DECLARE @Tax DECIMAL(10,2)
    SET @Tax = @Amount * 0.15
    RETURN @Tax
END





-------------------------------------------------------
Q stored procedures vs functions

| Feature         | Stored Procedure | Function         |
| --------------- | ---------------- | ---------------- |
| Returns value   | âŒ Optional       | âœ… Mandatory      |
| Used in SELECT  | âŒ No             | âœ… Yes            |
| Can modify data | âœ… Yes            | âŒ No             |
| Transactions    | âœ… Yes            | âŒ No             |
| Error handling  | âœ… TRY/CATCH      | âŒ Limited        |
| Performance     | âœ… Better         | âš ï¸ Can be slower |
| Business logic  | âœ… Yes            | âŒ Limited        |


--------------------------------------------------------

Q How will you check the query taking time - Execution Plan or SQL Profiler

Execution Plan tells why a query is slow.
SQL Profiler tells which query is slow and when it ran.



Execution Plan (MOST IMPORTANT for performance tuning)
What it shows

How SQL Server executes your query

Operators used:
Table scan

Index Seek / Scan

Hash Match

Nested Loop

Cost distribution

Missing indexes

Estimated vs Actual rows

Types

1 Estimated Execution Plan

2 Actual Execution Plan âœ… (preferred)



SET STATISTICS PROFILE ON;
SELECT * FROM Orders WHERE CustomerId = 10;
 or
 (Ctrl + M)
 
 
 
 ------------------------------------------
 
 Q What is Common Table Expression - explain the scenario
A Common Table Expression (CTE) is a temporary named result set that exists only during the execution of a single query. 




----------------------------------------------------

Q Mediator Design patterns



The Mediator Design Pattern is a behavioral pattern that reduces coupling between components 
by making them communicate through a central mediator object instead of directly with each other.

Without Mediator:

Component A â†â†’ Component B
    â†•            â†•
Component C â†â†’ Component D

With Mediator:
Component A â†’ Mediator â† Component B
              â†•
Component C â†’ â†‘ â† Component D





----------------------------------------------------


Q What is Volumes in Kubernetes?

In Kubernetes, a Volume is a way to store and share data used by containers inside a Pod.

â“ Why do we need Volumes?

By default:

Container file systems are ephemeral (temporary)
If a container restarts or crashes, its data is lost

ğŸ‘‰ Volumes solve this problem by providing storage that:

Lives longer than a container
Can be shared between containers in the same Pod
Can be persistent (even after Pod restarts)

A Volume is defined at the Pod level
All containers in the Pod can mount the same volume
Volume lifecycle depends on its type

Pod
 â”œâ”€â”€ Container A â”€â”€â”
 â”œâ”€â”€ Container B â”€â”€â”¤â”€â”€ Shared Volume
 â””â”€â”€ Container C â”€â”€â”˜


types of volumes:
1 emptyDir
craeted when pod starts and deleted when pod is removed.
Used for temporary data

volumes:
- name: cache-volume
  emptyDir: {}

2 HostPath
Uses a directory from the nodeâ€™s filesystem
Tightly coupled to the node

hostPath:
  path: /data/app
  
3 ConfigMap Volume
4 Secret Volume # Automatically base64-encoded

5 PersistentVolume (PV) & PersistentVolumeClaim (PVC)
for long-term persistent storage
Backed by cloud disks (Azure Disk)

persistentVolumeClaim:
  claimName: my-pvc



------------------------------------------

Q PersistentVolume (PV) vs PersistentVolumeClaim (PVC)

A PV is actual storage in the cluster.
Created by cluster admin (or dynamically by StorageClass)

A PVC is a request for storage.
Created by developer.
Access mode (ReadWriteOnce, ReadOnlyMany, ReadWriteMany)

1ï¸âƒ£ Developer creates PVC
2ï¸âƒ£ Kubernetes searches for a matching PV
3ï¸âƒ£ If found â†’ binds PVC to PV
4ï¸âƒ£ Pod uses PVC
5ï¸âƒ£ Data persists even if Pod restarts


apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-data
spec:
  capacity:
    storage: 10Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: /mnt/data

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pvc-data
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
----
pod using PVC 

volumes:
- name: app-storage
  persistentVolumeClaim:
    claimName: pvc-data


ğŸ”„ PV Reclaim Policy (Important)

| Policy  | Meaning                      |
| ------- | ---------------------------- |
| Retain  | Data kept after PVC deletion |
| Delete  | Storage deleted  (default)   |
| Recycle | (Deprecated)                 |


âš™ï¸ Dynamic Provisioning (Modern Way)

With StorageClass:
No need to manually create PV
PVC auto-creates PV

storageClassName: managed-premium


------------------------------------

Q What is a StorageClass?
A StorageClass defines how storage is dynamically created in Kubernetes.

ğŸ‘‰ It tells Kubernetes:

Which storage backend to use (Azure Disk, AWS EBS, etc.)
What type of disk (SSD, HDD, premium, standard)
How volumes should be provisioned and reclaimed

Without StorageClass:

Admin must manually create PVs
Not scalable âŒ

With StorageClass:
Developer creates only PVC
Kubernetes auto-creates PV âœ…

Pod â†’ PVC â†’ StorageClass â†’ PV â†’ Cloud Disk


apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: managed-premium
provisioner: kubernetes.io/azure-disk
parameters:
  storageaccounttype: Premium_LRS
  kind: Managed
reclaimPolicy: Delete # retain, delete
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer


IMP storaageClass is scalable

-----


apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: app-pvc
spec:
  storageClassName: managed-premium
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi

ğŸ‘‰ PV will be created automatically ğŸ‰

C:\Users\Admin>kubectl get storageclass
NAME                 PROVISIONER                RECLAIMPOLICY   VOLUMEBINDINGMODE   ALLOWVOLUMEEXPANSION   AGE
standard (default)   k8s.io/minikube-hostpath   Delete          Immediate           false                  9d


--------------------------------------


Q What is StateFulSet?


A StatefulSet is a Kubernetes workload used to manage stateful applications that require:

Stable Pod identity
Stable network name
Persistent storage per Pod
Ordered startup and shutdown.

Pods are:

Created sequentially (0 â†’ 1 â†’ 2)
Deleted in reverse order

apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
spec:
  serviceName: mysql
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql
        volumeMounts:
        - name: data
          mountPath: /var/lib/mysql
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: managed-premium
      resources:
        requests:
          storage: 10Gi
		  
		  
| Feature      | Deployment        | StatefulSet     |
| ------------ | ----------------- | --------------- |
| Pod Identity | Random            | Stable          |
| Pod Name     | auto-generated    | Predictable     |
| Storage      | Shared / optional | One PVC per Pod |
| Scaling      | Any order         | Ordered         |
| Best For     | APIs              | Databases       |


---------

Q when we appply deployment ,pod gets dynamic randon name. Any way to assigned user defined name?

In Kubernetes, when you create a Deployment, the Pod name is always auto-generated.
ğŸ‘‰ You cannot assign a fixed, user-defined Pod name in a Deployment.

Use labels (BEST PRACTICE)
Instead of relying on pod names, use labels.

kubectl get pods -l app=myapp
------------------------------------------------------------


Q In ASP.NET how to consume scoped service in a singleton service?
 public MySingleton(IServiceScopeFactory scopeFactory)
    {
        _scopeFactory = scopeFactory;
    }
	
	or 
	
	
	  public MySingleton(IServiceProvider serviceProvider)
    {
        _serviceProvider = serviceProvider;
    }
	
	
	
-------------------------------------------------------------------------------------

Q IServiceScopeFactory vs IServiceProvider ?

IServiceProvider

public class MyService
{
    private readonly IServiceProvider _provider;

    public MyService(IServiceProvider provider)
    {
        _provider = provider;
    }

    public void DoWork()
    {
        var logger = _provider.GetRequiredService<ILogger<MyService>>();
    }
}

Key rules ğŸš¨

âŒ Resolving scoped services from root provider is dangerous
âŒ Causes memory leaks
âŒ Breaks scope rules


IServiceScopeFactory

public class BackgroundWorker
{
    private readonly IServiceScopeFactory _scopeFactory;

    public BackgroundWorker(IServiceScopeFactory scopeFactory)
    {
        _scopeFactory = scopeFactory;
    }

    public async Task RunAsync()
    {
        using var scope = _scopeFactory.CreateScope();
        var db = scope.ServiceProvider.GetRequiredService<AppDbContext>();

        await db.SaveChangesAsync();
    }
}

âœ” Scoped services behave correctly
âœ” No memory leaks
âœ” Safe for background tasks


âŒ This is a common anti-pattern

services.AddSingleton<MyService>();

public MyService(IServiceProvider provider)
{
    _db = provider.GetRequiredService<AppDbContext>(); // âŒ scoped from singleton
}


What goes wrong?

Scoped service becomes effectively singleton
Menory leak.

--------------------------------------------------------------------------------

Q what is DI lifetime memory leaks?

DI lifetime memory leaks happen when objects live longer than they should, usually because a long-lived service (Singleton) 
accidentally holds a reference to a short-lived service (Scoped/Transient).

public class Worker : BackgroundService
{
    private readonly MyScopedService _service; // âŒ

    public Worker(MyScopedService service)
    {
        _service = service;
    }
}

âœ” App starts â†’ scoped resolved
âŒ Scope never ends
âŒ Memory leak guaranteed



--------------------------------------------------------


Q What is the difference between Azure App Service WebJobs and Function Apps?

WebJob
Runs alongside your Web App.
Can be:

Continuous

Triggered (Queue, Timer)


| Concept    | WebJobs                    | Function Apps         |
| ---------- | -------------------------- | --------------------- |
| Hosting    | Inside App Service         | Standalone serverless |
| Scaling    | Manual / App Service scale | Automatic             |
| Billing    | App Service cost           | Pay per execution     |
| Isolation  | Shares resources           | Isolated              |
| Deployment | App + Job                  | Function-by-function  |


---------------------------


Q What are the different types of triggers a web job can have?

1ï¸âƒ£ Continuous WebJob
ğŸ‘‰ How it runs

Starts automatically when the App Service starts

Runs continuously in a loop

2ï¸âƒ£ Triggered WebJob

Triggered WebJobs run only when triggered.

ğŸ”¸ a) Manual Trigger

Started manually from:

Azure Portal

Azure CLI

Runs once and stops

b) Scheduled (Timer) Trigger

Runs on a CRON schedule

Similar to a scheduled task

c Blob Trigger

Triggered when a blob is added or updated in Azure Blob Storage

b ğŸ”¸ Timer Trigger


| Trigger Type      | WebJobs    | Function Apps |
| ----------------- | ---------- | ------------- |
| HTTP Trigger      | âŒ          | âœ…             |
| Event Grid        | âŒ          | âœ…             |
| Service Bus Topic | âš ï¸ Limited | âœ…             |
| Event Hub         | âš ï¸ Limited | âœ…             |




----------------------------------------

Q How many background service we cen have in one asp .net web api
There is NO hard limit.

builder.Services.AddHostedService<EmailWorker>();
builder.Services.AddHostedService<CleanupWorker>();
builder.Services.AddHostedService<QueueWorker>();


âš ï¸ Very Important: Multi-Instance Behavior (Interview Favorite)

If your Web API scales to N instances:

Instance 1 â†’ all background services run
Instance 2 â†’ all background services run
Instance N â†’ all background services run



-------------------------------------------

Q Difference between IHostedService and BackgroundService?
ğŸ”¹ IHostedService
ğŸ‘‰ What it is

A low-level interface
Gives full control over start and stop
You manage threads/tasks yourself

public class MyService : IHostedService
{
    public Task StartAsync(CancellationToken token)
    {
        // startup logic
        return Task.CompletedTask;
    }

    public Task StopAsync(CancellationToken token)
    {
        // cleanup logic
        return Task.CompletedTask;
    }
}


BackgroundService
ğŸ‘‰ What it is

An abstract base class
Built on top of IHostedService
Designed for long-running workers


public class Worker : BackgroundService
{
    protected override async Task ExecuteAsync(CancellationToken token)
    {
        while (!token.IsCancellationRequested)
        {
            await DoWorkAsync();
            await Task.Delay(5000, token);
        }
    }
}





-------------------------------------

Q What is mean by model binding in asp net ?

Model Binding is the process by which ASP.NET automatically maps incoming HTTP 
request data to action method parameters or model objects.


----------------------------------------


Q I am using Entity Framework Core in my enterprise applications. I want to use 
database-first approach. So whenever I am creating a new table, I will create 
that table in SQL and then its respective class in my .NET web API. So whenever
 I am running a migration, I need to ensure that new table is not getting generated. How to achieve this?
 
 
DO NOT USE Migrations at All (Most Common) 


protected override void OnModelCreating(ModelBuilder modelBuilder)
{
    modelBuilder.Entity<Customer>(entity =>
    {
        entity.ToTable("Customer_Master");
        entity.HasKey(e => e.Id);
        entity.Property(e => e.Id).HasColumnName("customer_id");
    });
}



How this will not create new table?


OnModelCreating NEVER creates tables.
It only tells EF Core how to map your C# model to an already existing database schema.



--------------------------------------------------


Q I have a .NET function app. I have opened that function app in Visual Studio.
How to check that function app is in process or out of process?


1 In process:
<Project Sdk="Microsoft.NET.Sdk.Functions">


Out-of-Process (Isolated Worker)
<Project Sdk="Microsoft.NET.Sdk">


2 In-Process â†’ No Program.cs
ğŸ”¹ Isolated â†’ Has Program.cs


3ï¸âƒ£ Check local.settings.json
 
 {
  "Values": {
    "FUNCTIONS_WORKER_RUNTIME": "dotnet"  # inprocess
  }
}


{
  "Values": {
    "FUNCTIONS_WORKER_RUNTIME": "dotnet-isolated" # out of process
  }
}



4ï¸âƒ£ Check NuGet Packages.

ğŸ”¹ In-Process
<PackageReference Include="Microsoft.NET.Sdk.Functions" />


ğŸ”¹ Isolated
<PackageReference Include="Microsoft.Azure.Functions.Worker" />
<PackageReference Include="Microsoft.Azure.Functions.Worker.Sdk" />





------------------------------------------------------------

Q Is it ideal to create service account without having Role ROleBinding?

Even without explicit RBAC (Role/RoleBinding), ServiceAccounts serve 
several important purposes

1 Identity for Pods

Each pod gets a unique identity that can be used by:
Istio/Service Mesh,Audit logs, Network policies.


------------------------------------------------------------

Q What is GatewayAPI?

GatewayAPI is modern implemenstaiton for ingress

Initialy ingress dont have capability for
1 Rate Limiting
2 WAF 
3 Http Redirect
4 Canary deployment
5 DDoS Attack
6 Rewrite URLs

Then k8s introduced annotations
but it makes ingress yaml makes complicated ,big and ownershhip overhead.
This was a workaround.

then GatewayAPI was introduced

GatewayAPI has 3 components
1 Gateway class (defines which controller to use eg ngnix. envoy)
2 Gateway
3 HttpRoute

These are CRDs




---------------------------


Q what is difference between URL ans URI

URI (Uniform Resource Identifier) = Identifier (name or location or both)
A string that identifies a resource - could be by location, name, or both.
Think: "Identifier" = anything that identifies something

URL (Uniform Resource Locator) = Locator (tells you WHERE and HOW to get it)
A string that identifies a resource AND tells you how to access it (protocol + location).
Think: "Locator" = tells you WHERE it is and HOW to get it

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              URI                    â”‚
â”‚   (Uniform Resource Identifier)     â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     URL      â”‚  â”‚     URN     â”‚  â”‚
â”‚  â”‚   (Locator)  â”‚  â”‚    (Name)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


URLs:
https://www.example.com/page.html
â”œâ”€ Protocol: https
â”œâ”€ Location: www.example.com
â””â”€ Path: /page.html
â†’ Tells you WHERE and HOW to access the resource

ftp://ftp.example.com/file.txt
â”œâ”€ Protocol: ftp
â”œâ”€ Location: ftp.example.com
â””â”€ Path: /file.txt
â†’ Tells you WHERE and HOW to access the resource

mailto:user@example.com
â”œâ”€ Protocol: mailto
â””â”€ Address: user@example.com
â†’ Tells you HOW to contact

file:///home/user/document.pdf
â”œâ”€ Protocol: file
â””â”€ Path: /home/user/document.pdf
â†’ Tells you WHERE on local filesystem



GET /api/users/123
    â””â”€ This is a URI (identifies the resource)
    â””â”€ When combined with host, becomes URL:
       https://api.example.com/api/users/123
	   
-------------------------------------------------------------

	   
Q Azure queue vs service bus vs event hub	  

1ï¸âƒ£ Azure Queue Storage

Key Characteristics

Point-to-point messaging
No ordering guarantee
No topics / subscriptions
Messages pulled by consumers
Very low cost

Limits

Message size: 64 KB
No duplicate detection
No transactions
No dead-letter queue


2ï¸âƒ£ Azure Service Bus

Key Features

Queues + Topics + Subscriptions
FIFO ordering
Dead-letter queue (DLQ)
Duplicate detection
Message sessions
Transactions
Scheduled messages
Exactly-once processing (with sessions).

Message Size

Standard: 256 KB
Premium: 100 MB



3ï¸âƒ£ Azure Event Hubs

(Big data & streaming platform)

What it is

A high-throughput event ingestion service
Built for telemetry and streaming data

Key Features

Millions of events per second
Partitioned event streams
Retention-based (not queue-based)
Multiple consumers read same events
Offset-based consumption
Integrates with Spark, Databricks, Stream Analytics

Not Supported

No message locking
No DLQ
No FIFO guarantee per consumer group

| Feature        | Azure Queue     | Azure Service Bus    | Azure Event Hubs |
| -------------- | --------------- | -------------------- | ---------------- |
| Messaging Type | Basic Queue     | Enterprise Messaging | Event Streaming  |
| Message Size   | 64 KB           | 256 KB â€“ 100 MB      | 20 MB             |
| Ordering       | âŒ               | âœ…                    | Partition-level  |
| Transactions   | âŒ               | âœ…                    | âŒ                |
| DLQ            | âŒ               | âœ…                    | âŒ                |
| Fan-out        | âŒ               | âœ… (Topics)           | âœ…                |
| Throughput     | Low             | Medium               | Very High        |
| Cost           | Cheapest        | Moderate             | Higher           |
| Retention      | Until processed | Until processed      | Time-based       |




----------------------------------------------

Q Why ordering is not guaranteed in Azure Queue Storage?

Because Azure Queue Storage is built on a distributed storage system that prioritizes scalability and availability 
over strict sequencing, so messages can be stored, replicated, and retrieved from different partitions

Distributed partitions (core reason)

Azure Queue Storage is part of Azure Storage
Messages are sharded across multiple partitions
A consumer may read from any partition
Network latency and partition placement cause out-of-order reads

â¡ï¸ There is no single ordered log.


---------------------------------

Q lead and lag function in sql server?

| Function | Purpose                         |
| -------- | ------------------------------- |
| **LAG**  | Get value from **previous row** |
| **LEAD** | Get value from **next row**     |


LAG (expression, offset, default) OVER (
    PARTITION BY column
    ORDER BY column
)

LEAD (expression, offset, default) OVER (
    PARTITION BY column
    ORDER BY column
)

offset â†’ how many rows before/after (default = 1)

default â†’ value if row does not exist (optional)

| EmpId | Month | Salary |
| ----- | ----- | ------ |
| 1     | Jan   | 50000  |
| 1     | Feb   | 52000  |
| 1     | Mar   | 55000  |
| 2     | Jan   | 40000  |
| 2     | Feb   | 42000  |



LAG exmaple

SELECT
    EmpId,
    Month,
    Salary,
    LAG(Salary) OVER (PARTITION BY EmpId ORDER BY Month) AS PrevMonthSalary
FROM EmployeeSalary;

| EmpId | Month | Salary | PrevMonthSalary |
| ----- | ----- | ------ | --------------- |
| 1     | Jan   | 50000  | NULL            |
| 1     | Feb   | 52000  | 50000           |
| 1     | Mar   | 55000  | 52000           |
| 2     | Jan   | 40000  | NULL            |
| 2     | Feb   | 42000  | 40000           |



LEAD:

SELECT
    EmpId,
    Month,
    Salary,
    LEAD(Salary) OVER (PARTITION BY EmpId ORDER BY Month) AS NextMonthSalary
FROM EmployeeSalary;

| EmpId | Month | Salary | NextMonthSalary |
| ----- | ----- | ------ | --------------- |
| 1     | Jan   | 50000  | 52000           |
| 1     | Feb   | 52000  | 55000           |
| 1     | Mar   | 55000  | NULL            |
| 2     | Jan   | 40000  | 42000           |
| 2     | Feb   | 42000  | NULL            |


------------------------------------------------------------


Q I have an sql table which maintains number of products sold in each month.
 write a sql query to get number of products sold difference in each month.
 
 
 | Month   | ProductsSold |
| ------- | ------------ |
| 2024-01 | 120          |
| 2024-02 | 150          |
| 2024-03 | 130          |
| 2024-04 | 180          |


SELECT
    Month,
    ProductsSold,
	
    ProductsSold 
      - LAG(ProductsSold) OVER (ORDER BY Month) AS MonthWiseDifference
	  
FROM Sales
ORDER BY Month;


| Month   | ProductsSold | MonthWiseDifference |
| ------- | ------------ | ------------------- |
| 2024-01 | 120          | NULL                |
| 2024-02 | 150          | 30                  |
| 2024-03 | 130          | -20                 |
| 2024-04 | 180          | 50                  |




Q In SQL common table expression, can we write any statement other than SELECT?

Yes

WITH cte_name AS ( ... )
<single SQL statement>;

WITH HighSalaryEmployees AS (
    SELECT *
    FROM Employees
    WHERE Salary > 80000
)
SELECT *
FROM HighSalaryEmployees;


WITH NewEmployees AS (
    SELECT Id, Name, Salary
    FROM TempEmployees
)
INSERT INTO Employees (Id, Name, Salary)
SELECT Id, Name, Salary
FROM NewEmployees;

WITH SalaryCTE AS (
    SELECT Id, Salary
    FROM Employees
    WHERE Department = 'IT'
)
UPDATE SalaryCTE
SET Salary = Salary + 5000;


WITH DuplicateEmployees AS (
    SELECT *,
           ROW_NUMBER() OVER (
               PARTITION BY Name, Salary
               ORDER BY Id
           ) AS rn
    FROM Employees
)
DELETE FROM DuplicateEmployees
WHERE rn > 1;



--------------------------------------------------------

Q DIfferent types of keys in sql?

Primary Key (PK): Uniquely identifies each row in a table. It cannot contain duplicate values or NULL values, 
and each table can have only one primary key.

Unique Key: Ensures that all values in a column (or set of columns) are unique. 
Unlike a primary key, it gen
ally allows one NULL value and a table can have multiple unique keys.

/**Foreign Key (FK): A column or a set of columns in one table (the referencing table) that refers to the
 primary key (or another candidate key) of another table (the referenced table). 
 It is used to maintain referential integrity and link data between tables.
 
Super Key: A set of one or more attributes (columns) that, taken together, 
uniquely identify a row within a table. It may contain unnecessary attributes.

Candidate Key: A minimal super key, meaning it has no redundant attributes but can still uniquely identify each row.
 All candidate keys have the potential to be the primary key.
 
Alternate Key: Any candidate key that was not chosen as the primary key for the table.

Composite Key: A key that consists of two or more columns to uniquely identify a row when a single column is 
insufficient. A composite key can be a primary key, unique key, or foreign key.

Surrogate Key: An artificial key, typically a system-generated sequence or auto-incremented integer, 
created specifically to be the primary key when no natural primary key exists or the natural key is too complex. 
It has no business meaning.

Compound Key: A specific type of composite key where each attribute in the key is a foreign key to another table. 


-------------------------------------------------------------

Q  table scan vs index scan vs index seek


1ï¸âƒ£ Table Scan
What it is

SQL Server reads every row in the table to find matching data.

SELECT *
FROM Employees;


SELECT *
FROM Employees
WHERE Salary > 1000;   -- no useful index


2ï¸âƒ£ Index Scan
What it is

SQL Server scans all or most of an index instead of the table

SELECT Name
FROM Employees
WHERE Salary > 1000;   -- index exists on Salary

or 

SELECT Name
FROM Employees
WHERE ID > 1000;   # this is indesx seek . Seek + Partial Scan of qualifying rows


or

WHERE CAST(ID AS VARCHAR) > '1000' # even though ID is primary key it , this will be index scan.


Execution behavior

Reads all leaf pages of the index
Still scans sequentially, but:
Index is smaller than table
Less I/O than table scan


3ï¸âƒ£ Index Seek (Best Case)
What it is

SQL Server directly jumps to required rows using index structure (B-Tree).

SELECT *
FROM Employees
WHERE EmployeeId = 101;


or 

SELECT *
FROM Employees
WHERE EmployeeId IN (1, 2, 3, 4, 5, 6);

âŒ When Can It Become an Index Scan

Even with an index, SQL Server may choose a scan when:

1ï¸âƒ£ IN list is very large

WHERE EmployeeId IN (1,2,3,...50000)


| Condition                             | Result           |
| ------------------------------------- | ---------------- |
| PK / Indexed column                   | âœ… Seek           |
| Range predicate (`>`, `<`, `BETWEEN`) | âœ… Seek           |
| Function on column                    | âŒ Scan           |
| No index                              | âŒ Scan           |
| Very small table                      | âš ï¸ Scan possible |



----------------------------------------

Q LINQ SelectMany

var numbers = new List<List<int>>
{
    new() { 1, 2, 3 },
    new() { 4, 5 },
    new() { 6 }
};

var result = numbers.SelectMany(n => n);
1, 2, 3, 4, 5, 6


var orderDetails = customers.SelectMany(
    c => c.Orders,
    (c, o) => new
    {
        CustomerId = c.Id,
        OrderId = o.OrderId,
        o.Amount
    });



CustomerId | OrderId | Amount
1          | 101     | 500
1          | 102     | 700
2          | 201     | 300



---------------------------------------------------------

Q You want to design an API which Requests sepcific data with specific filters. How will you design it.
Will you create one endpoint or multiple Endpoint?

For most cases, I'd recommend one endpoint with query parameters for filtering. 
This follows REST principles and keeps your API clean and maintainable.

GET /api/products
GET /api/products?category=electronics&price[gte]=100&price[lte]=500
GET /api/products?sort=-createdAt&limit=20&page=2
GET /api/products?fields=id,name,price&include=reviews,category


1. Query Parameter Structure

GET endpoint

?category=electronics&status=active
?price[min]=100&price[max]=500
?tags=tag1,tag2,tag3
?sort=-price,name
?limit=20&offset=40
?include=category,reviews
?fields=id,name,price


2. Advanced Filter Format (for complex needs)
POST

For very complex queries, consider a structured format:

{
  "filters": {
    "and": [
      {"field": "status", "operator": "eq", "value": "active"},
      {"field": "price", "operator": "between", "value": [100, 500]}
    ]
  },
  "sort": [{"field": "price", "direction": "desc"}],
  "pagination": {"page": 1, "size": 20}
}


When Multiple Endpoints Make Sense:

Performance profiles differ dramatically (e.g., real-time vs. batch queries)
Security models vary significantly (different auth requirements)
Return formats are fundamentally different (e.g., CSV vs. JSON vs. PDF)
Business logic is completely separate (unrelated use cases)

GET  /api/products/summary           # Lightweight summary
GET  /api/products/export            # Full export (CSV/Excel)
POST /api/products/bulk-query        # Very complex multi-resource query
GET  /api/products/{id}/related      # Specialized related items logic


Start with a single flexible endpoint and only create additional endpoints when you have concrete, 
measurable reasons to do so. This approach balances flexibility with maintainability and follows the principle of 
"design for the 80% use case, handle the 20% as exceptions."



-------------------------------------------------------------------

Q What is the Host Header?

When you visit a website, your browser sends an HTTP request that includes a Host header:

GET /index.php HTTP/1.1
Host: example.com

The problem occurs when applications trust the Host header without validation and use it to:

Generate password reset links
Build absolute URLs
Determine which virtual host to serve
Configure caching behavior
Construct redirects

# Bad
reset_link = f"https://{request.headers['Host']}/reset?token={token}"

# Good  
reset_link = f"https://{CONFIGURED_DOMAIN}/reset?token={token}"

-------------------------------------------------------------------------



Q What is "AllowHosts" : "*" In asp .net core?

Youâ€™ll usually see it in appsettings.json:

This setting is used by Host Filtering Middleware in ASP.NET Core.

Host filtering protects your app from Host Header Attacks.

| Value                                 | Meaning                                |
| ------------------------------------- | -------------------------------------- |
| `"*"`                                 | Accept requests from **any host name** |
| `"myapi.example.com"`                 | Accept only this host                  |
| `"myapi.example.com;api.example.com"` | Accept multiple hosts                  |



----------------------------------------------------

Q Difference between AllowedHosts vs CORS?

ğŸ” AllowedHosts vs ğŸŒ CORS â€” Clear Difference

1ï¸âƒ£ AllowedHosts (Host Header validation)
What it protects

Your server from malicious or unexpected Host headers

Where it works

Server-side
Runs before MVC
Part of ASP.NET Core Host Filtering

400 Bad Request

What problem it solves

Host header attacks
DNS rebinding attacks
Misrouted traffic


2ï¸âƒ£ CORS (Cross-Origin Resource Sharing)
What it protects

Which front-end origins can READ responses from your API

Where it works

Browser-enforced
Affects JavaScript running in browsers
Does NOT block requests, only blocks response access.


MOST IMPORTANT DIFFERENCE (Interview trap)

âŒ CORS does NOT protect your API from being called

Attackers can still:

Call API using Postman
Call API using curl
Call API from servers

CORS only controls browser JavaScript access.

What happens:

Request IS sent - The browser sends the HTTP request to site-b.com
Server processes it - The server receives and processes the request (database queries run, side effects happen)
Server responds - The server sends back the response with CORS headers
Browser blocks access - The browser checks CORS headers and blocks JavaScript from reading the response if headers don't permit it.

IMP : If the preflight fails, then the actual request is blocked. But simple requests (GET, POST with simple body) skip preflight.


-----------------------------------------------------------------

Q In which cases browser block CORS request?

When preflight fails.


----------------------------------------------------


Q What is preflight request?

The browser distinguishes between "simple requests" (no preflight) and "non-simple requests" (preflight required).


Simple Requests (NO Preflight)
A request is "simple" and skips preflight if it meets ALL these conditions:
1. HTTP Method Must Be:

GET
HEAD
POST

2. Only Simple Headers Are Used:

Accept
Accept-Language
Content-Language
Content-Type (with restrictions below)
Range (with restrictions)

3. Content-Type Must Be One Of:

application/x-www-form-urlencoded
multipart/form-data
text/plain

4. No Custom Headers
No Authorization, X-Custom-Header, or other non-simple headers.

Non-Simple Requests (Preflight Required)
A preflight is triggered if ANY of these conditions are true:
1. HTTP Method is:

PUT
DELETE
PATCH
CONNECT
OPTIONS
TRACE
Any custom method

2. Custom Headers Are Used:
3. Content-Type is:

application/json â† Most common trigger!
application/xml
text/xml
Anything other than the three simple types


IMP : httpVerb of preflight request is 'Options'.


-------------------------------------------------------------------

Q What is a DDoS (Distributed Denial of Service) Attack?

A DDoS attack is a cyberattack where many compromised systems (bots) flood a target server, API, or network 
with massive traffic, making it slow, unstable, or completely unavailable to real users.


DDoS = Overwhelm a system with fake traffic so real users canâ€™t use it.

Why itâ€™s called Distributed

Traffic comes from many IPs
Hard to block using IP filtering
Looks like real users


| DoS             | DDoS               |
| --------------- | ------------------ |
| Single attacker | Many attackers     |
| Easy to block   | Very hard to block |
| Limited scale   | Massive scale      |




What DDoS does NOT do âŒ

âŒ Steal data

âŒ Hack accounts

âŒ Inject malware

It only denies availability.


How to prevent / mitigate DDoS
1 Rate Limiting
2ï¸âƒ£ CDN & Anycast networks

Absorb traffic
Distribute load globally

3ï¸âƒ£ DDoS protection services

Azure DDoS Protection
AWS Shield
Cloudflare

4ï¸âƒ£ WAF (Web Application Firewall)

Blocks:
Abnormal patterns
Bot behavior


| Attack        | Goal                         |
| ------------- | ---------------------------- |
| XSS           | Steal user data              |
| CSRF          | Perform unauthorized actions |
| SQL Injection | Access database              |
| **DDoS**      | Take service down            |


------------------------------------------------------------------

Q What is cross site scripting attack 

Cross-Site Scripting (XSS) is a security vulnerability where an attacker injects malicious JavaScript into a trusted website, 
and that script runs in the victimâ€™s browser.

ğŸ‘‰ The key point:
The attack runs on the client (browser), not on the server.


When malicious JavaScript runs in a userâ€™s browser, it can:

Steal cookies / JWT tokens
Hijack user sessions
Perform actions as the logged-in user
Modify page content (phishing)

Redirect users to malicious sites

| XSS                | SQL Injection        |
| ------------------ | -------------------- |
| Attacks **users**  | Attacks **database** |
| Runs in browser    | Runs on server       |
| Uses JavaScript    | Uses SQL             |
| Client-side impact | Server-side impact   |




How to prevent XSS (CRITICAL)

âœ… 1. Output Encoding (MOST IMPORTANT)

Never trust user input.

@Html.Encode(userInput)

ASP.NET Razor auto-encodes by default âœ…

âœ… 2. Avoid innerHTML
âŒ Bad:
element.innerHTML = userInput;


âœ… Good:
element.textContent = userInput;

âœ… 3. Content Security Policy (CSP)
Content-Security-Policy: script-src 'self'
Blocks inline scripts even if injected.

app.Use(async (context, next) =>
{
    context.Response.Headers.Add(
        "Content-Security-Policy",
        "default-src 'self'; script-src 'self'; object-src 'none';"
    );

    await next();
});



âœ… 4. HttpOnly cookies
Set-Cookie: auth=xyz; HttpOnly; Secure
Prevents JS from reading cookies.

Common misconception âŒ

Never return raw HTML from APIs
âŒ Bad
return Content(userInput, "text/html");

âœ… Good
return Ok(new { message = userInput });

âŒ â€œXSS happens because of missing authenticationâ€

Wrong.
XSS happens because of unsafe rendering of untrusted data.

-------------------------------------------------------------
Q What is cross site resource forging attack?

Cross-Site Request Forgery (CSRF) is an attack where a malicious website tricks a userâ€™s browser into
 sending an unwanted request to a trusted website where the user is already logged in.

ğŸ‘‰ The browser automatically includes cookies, so the trusted site thinks the user made the request.

CSRF = Attacker makes a logged-in user perform actions without their consent.



Real-world example (Banking)

Assumptions
You are logged into your bank: bank.com
Authentication uses cookies
Session is still active

Attackerâ€™s malicious page
<img src="https://bank.com/transfer?to=attacker&amount=10000" />

What happens?

You visit attacker.com
Browser automatically sends request to bank.com
Browser includes your session cookie
Bank processes transfer âŒ
ğŸ‘‰ You never clicked â€œTransferâ€.

Why CSRF works

Because browsers:

Automatically attach cookies
Automatically attach authentication headers
Do NOT distinguish user-intended vs forged requests


Why JWT in headers reduces CSRF risk
Authorization: Bearer <token>

Then:

Browser does NOT auto-attach it
Attacker cannot forge request easily
ğŸ‘‰ CSRF mostly affects cookie-based authentication

âœ… 1ï¸âƒ£ Anti-forgery tokens (MOST IMPORTANT)

Server generates token:

<input type="hidden" name="__RequestVerificationToken" value="abc123" />

Server validates token for every request.
ğŸ” Attacker cannot guess token.

âœ… 2ï¸âƒ£ SameSite cookies
Set-Cookie: auth=xyz; SameSite=Strict; Secure; HttpOnly

âœ… 3ï¸âƒ£ Validate HTTP methods

âŒ Donâ€™t allow state change via GET

âœ… Use POST / PUT / DELETE

-----------------------------------------------------------

Q CSRF vs CORS?

1ï¸âƒ£ CSRF (Cross-Site Request Forgery)
What problem does CSRF address?

Unauthorized actions performed using a logged-in userâ€™s session

Who is the attacker?

A malicious website
Tricks the browser into sending a request


2ï¸âƒ£ CORS (Cross-Origin Resource Sharing)
What problem does CORS address?

Which websites are allowed to read responses from your API

Who enforces it?

Browser, not server logic

Key point

Prevents JavaScript from reading cross-origin responses

Does NOT stop requests from being sent

CSRF works even if CORS blocks the response

----------------------------------------------------------
Q What is Sql injection ?

security attack where an attacker injects malicious SQL code into an applicationâ€™s input fields, 
causing the database to execute unintended queries.


How to prevent SQL Injection (CRITICAL)
âœ… 1ï¸âƒ£ Use Parameterized Queries (BEST PRACTICE)

string query =
  "SELECT * FROM Users WHERE Username = @u AND Password = @p";

var cmd = new SqlCommand(query, conn);
cmd.Parameters.AddWithValue("@u", username);
cmd.Parameters.AddWithValue("@p", password);

âœ… 2ï¸âƒ£ Use ORM frameworks (EF Core, Dapper)

âœ… 3ï¸âƒ£ Validate input (defense-in-depth)

Length limits
Allow-list characters
Reject unexpected input

âœ… 4ï¸âƒ£ Use least-privilege DB accounts

No DROP, ALTER permissions
Read-only where possible

------------------------------------------------------------
Q What is app.UseHsts()?

app.UseHsts() enables HTTP Strict Transport Security (HSTS) for your application.
Always use HTTPS for this website â€” never use HTTP again.

Why HSTS is important

Without HSTS:

First request can be downgraded to HTTP
Vulnerable to SSL stripping attacks

With HSTS:

Browser refuses insecure connections
Prevents man-in-the-middle attacks

--------------------------------------------------------
Q app.UseHttpRedirection() 
app.UseRouting()

Explain 

1ï¸âƒ£ app.UseHttpsRedirection()
What it does

Automatically redirects HTTP requests to HTTPS

If a request comes on http://, it returns a 301 / 307 redirect to https://


app.UseRouting()
What it does

Matches the incoming request to a route

Finds which controller/action/endpoint should handle the request

Does NOT execute the controller yet


Request
  â†“
UseRouting()   â†’ Matches endpoint
  â†“
UseAuthorization()
  â†“
MapControllers() â†’ Executes endpoint
  â†“
Response


------------------------------------------------

Q which which case app.UseRouting() can be missing in pipeline ?


.NET 6+ Minimal Hosting Model (most common now)



------------------------------------------------
Q UseHsts vs UseHttpsRedirection

UseHttpsRedirection() - Redirects HTTP requests to HTTPS (302/301 redirect)
UseHsts() - Tells browsers to only use HTTPS for future requests (security header)

 app.UseHttpsRedirection();
```

When a user visits `http://example.com`:
```
Client â†’ HTTP Request: http://example.com
         â†“
Server â†’ 307 Temporary Redirect
         Location: https://example.com
         â†“
Client â†’ HTTPS Request: https://example.com
Server â†’ 200 OK (serves the page)



app.UseHsts();
Strict-Transport-Security: max-age=31536000; includeSubDomains
```

### How HSTS Works (Timeline):

**First Visit:**
```
Client â†’ HTTP Request: http://example.com
Server â†’ 307 Redirect â†’ https://example.com
Client â†’ HTTPS Request: https://example.com
Server â†’ 200 OK
         Strict-Transport-Security: max-age=31536000
```

**Second Visit (within max-age):**
```
User types: http://example.com
Browser â†’ Automatically upgrades to https://example.com (NO HTTP REQUEST SENT!)
Server â†’ 200 OK
-----------------------------------------------------


Q what is conditional middleware?


Apply middleware only when a condition is true.

instead of app.use() use app.UseWhen()


app.UseWhen(context => context.Request.Path.StartsWithSegments("/api"),
    appBuilder =>
    {
        appBuilder.UseMiddleware<ApiLoggingMiddleware>();
        appBuilder.UseMiddleware<ApiAuthMiddleware>();
    });


or 

app.Map

app.Map("/admin", adminApp =>
{
    adminApp.UseMiddleware<AdminAuthMiddleware>();
    adminApp.MapControllers();
});



--------------------------------------------

Q app.usewhen vs app.map ?

UseWhen()

Request
   â†“
Middleware 1
   â†“
UseWhen (condition: /api)
   â”œâ”€ TRUE â†’ [Conditional Middleware] â”€â”€â”
   â”‚                                     â”‚
   â””â”€ FALSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                         â†“
                                   Middleware 2  â† Both paths rejoin here
                                         â†“
                                   Middleware 3
                                         â†“
                                    Response
									
									
Map()

Request
   â†“
Middleware 1
   â†“
Map (path: /api)
   â”œâ”€ TRUE â†’ [Branch Middleware] â†’ Response  (Pipeline ends here)
   â”‚
   â””â”€ FALSE â†’ Middleware 2
                   â†“
              Middleware 3
                   â†“
              Response									
			  
			  
--------------------------------------------------

Q app.Map() vs app.RUn()

app.Run() - Terminal middleware that handles ALL requests that reach it
app.Map() - Conditional branching based on path, creates separate pipeline



---------------------------------------------------------

Q I want to understand OAuth 2.0 flow, so to create ChatGPT account, I used Sign-in with Google, so in this flow,
 can you explain how OAuth works internally in details, what is the IDP, Authorization Server, everything?


| Term                        | In your example              |
| --------------------------- | ---------------------------- |
| **User (Resource Owner)**   | You                          |
| **Client Application**      | ChatGPT                      |
| **Identity Provider (IdP)** | Google                       |
| **Authorization Server**    | Google OAuth Server          |
| **Resource Server**         | Google APIs (Profile, Email) |
| **Redirect URI**            | ChatGPT callback URL         |


1ï¸âƒ£ You click â€œSign in with Googleâ€

You are on ChatGPTâ€™s login page.


2ï¸âƒ£ ChatGPT redirects you to Google (Authorization Request)	

ChatGPT sends your browser to Google:

GET https://accounts.google.com/o/oauth2/v2/auth

With parameters like:
client_id=chatgpt-client-id
redirect_uri=https://chatgpt.com/auth/callback
response_type=code #code â†’ Authorization Code Flow
scope=openid email profile
state=xyz123 #prevents CSRF attacks
	  
	  
3ï¸âƒ£ Google authenticates YOU (IdP role)

Google now acts as Identity Provider.

It asks you to:

Enter password
Use MFA
Confirm account	  


4ï¸âƒ£ Google asks for Consent

You see:

â€œChatGPT wants access to:

Your email
Your profileâ€

You click Allow.

ğŸ‘‰ This is Authorization (not authentication).


5ï¸âƒ£ Google sends Authorization Code to ChatGPT

Google redirects your browser:

302 Redirect
Location: https://chatgpt.com/auth/callback?code=abc123&state=xyz123


6ï¸âƒ£ ChatGPT exchanges code for tokens (Back-channel)

ChatGPT backend (server-to-server):

POST https://oauth2.googleapis.com/token
client_id
client_secret
code=abc123
redirect_uri
grant_type=authorization_code
ğŸ” client_secret is NEVER exposed to browser

7ï¸âƒ£ Google returns tokens

Google responds:
{
  "access_token": "ya29.a0AfH6...", # mostly JWT
  "id_token": "eyJhbGciOiJSUzI1NiIs...", #always JWT
  "expires_in": 3600,
  "token_type": "Bearer"
}

| Token                        | Purpose                            |
| ---------------------------- | ---------------------------------- |
| **ID Token**                 | Proves **who you are** (OIDC)      |
| **Access Token**             | Allows ChatGPT to call Google APIs |
| **Refresh Token** (optional) | Get new access tokens              |


8ï¸âƒ£ ChatGPT validates the ID Token

ChatGPT checks:

Signature (Google public keys)
Issuer (iss)
Audience (aud)
Expiry (exp)
Email, subject (sub)

If valid:
âœ… You are authenticated


------------------------------------------------------------------------


Q What is difference between Middleware and filters in asp .net?

| Aspect                      | Middleware                      | Filters                  |
| --------------------------- | ------------------------------- | ------------------------ |
| Scope                       | **Global** (entire app)         | **MVC / Endpoint only**  |
| Executes                    | Before routing & after response | Around controller/action |
| Framework                   | ASP.NET Core pipeline           | MVC / Minimal API        |
| Access to controller        | âŒ No                            | âœ… Yes                    |
| Access to model/action args | âŒ No                            | âœ… Yes                    |
| Runs for                    | Every request                   | Only mapped endpoints    |

1ï¸âƒ£ Middleware â€” pipeline-level

Middleware is a component in the HTTP request pipeline that can:
Inspect or modify requests
Short-circuit requests
Inspect or modify responses

Characteristics

Runs for every request (API, MVC, static files)
Order matters

No knowledge of:
  Controller
  Action
  Model

Typical use cases

Logging
Authentication
Authorization
CORS
Exception handling
Rate limiting
HSTS / HTTPS redirection

2ï¸âƒ£ Filters â€” MVC / Endpoint-level
What are Filters?

Filters run inside MVC, around controller actions.

They can:
Run before/after an action
Inspect action arguments
Inspect result
Cancel action execution


Authorization Filter
 â†’ Resource Filter
   â†’ Action Filter
     â†’ Action Method
   â† Action Filter
 â† Resource Filter
Result Filter


----------------------------------------------------------------------

Filters runs only for mvc. What does it mean?

Filters execute only when a request is handled by the MVC framework (Controllers / MVC actions), 
not for every HTTP request.

What counts as â€œMVCâ€ in ASP.NET Core?

Filters run only when the request is processed by:

âœ… Controllers ([ApiController], ControllerBase)
âœ… MVC actions (IActionResult)
âœ… Razor Pages (page filters)

They do NOT run for:

âŒ Static files (.css, .js, images)
âŒ Middleware-only endpoints
âŒ Requests short-circuited by middleware
âŒ Requests that never reach MVC


-----------------------------------------------------------------------

Q how to short circuit in middleware?

app.Use(async (context, next) =>
{
    if (!context.User.Identity?.IsAuthenticated ?? true)
    {
        context.Response.StatusCode = StatusCodes.Status401Unauthorized;
        await context.Response.WriteAsync("Unauthorized");
        return; // ğŸ”´ pipeline stops here
    }

    await next(); // continue
});



--------------------------------------------------


Q What if I register a middleware after mapController ?

If you register a middleware after app.MapControllers(), 
that middleware will NOT run for controller requests.




-------------------------------------

Q What is terminal Middlewares in . net 8

terminal Middlewares  : Handles the request and does NOT call the next middleware, so the request pipeline stops there.

app.Run()



---------------------------------------------------------------


Q What is mean by Anti Pattern in software development?

An anti-pattern is a commonly used solution that looks like a good idea at first, but causes more problems than it solves over time.

In short:
Anti-pattern = A bad practice that feels like a solution.


Why anti-patterns are dangerous

They often work initially
They get copied by others
They create technical debt
They make systems:
 Hard to maintain
 Hard to test
 Hard to scale
 Hard to debug
 
 
-------------------------------------------------------------

what is minimal API?

A Minimal API is a lightweight way to build HTTP APIs in ASP.NET Core with very little boilerplate
â€”no controllers, no Startup class, just endpoints mapped directly in Program.cs.


var app = builder.Build();

app.MapGet("/users/{id}", (int id) =>
{
    return Results.Ok(new { Id = id });
});

app.Run();


Key characteristics of Minimal APIs
1ï¸âƒ£ No Controllers, No Startup

Everything lives in Program.cs

Uses endpoint routing directly


2ï¸âƒ£ Function-based endpoints

Endpoints are just delegates (lambdas or methods):

app.MapPost("/users", (User user) => Results.Created("/users/1", user));


3ï¸âƒ£ Built-in Dependency Injection

You can inject services directly into endpoints:

app.MapGet("/orders", (IOrderService service) =>
{
    return service.GetOrders();
});

4ï¸âƒ£ Automatic model binding & validation
app.MapPost("/login", (LoginRequest request) =>
{
    return Results.Ok();
});

Supports:

Route values
Query params
Headers
Body binding

5ï¸âƒ£ Supports filters, auth, middleware

Endpoint filters
Authorization policies
Middleware pipeline
OpenAPI / Swagger

app.MapGet("/admin", () => "Secret")
   .RequireAuthorization("AdminPolicy");




limitations

Minimal APIs use Endpoint Filters, not MVC filters.

| MVC Filters      | Minimal API Filters |
| ---------------- | ------------------- |
| Authorization    | âš ï¸ Limited          |
| Resource filters | âŒ Not available     |
| Action filters   | âŒ Not available     |
| Result filters   | âŒ Not available     |


3ï¸âƒ£ Less discoverable for new developers

No [ApiController]
No controller naming conventions
Logic hidden inside lambdas
âŒ Onboarding takes longer in large codebases.



Versioning & documentation complexity

API versioning is more manual

Swagger grouping needs extra work


When Minimal APIs shine âœ…

âœ… Microservices
âœ… Internal APIs
âœ… POCs & MVPs
âœ… High-performance endpoints
âœ… Small teams




--------------------------------------------------------------------------



Q  I design an API which interacts with SQL database. Over the time, my API started growing and number of users 
started increasing. Then I used horizontal scaling in my API server and used more powerful app service instances 
of Azure. This way it was able to handle more number of users simultaneously. But my database is same. 
So how to handle database in this case so that there should not be a delay in the response or memory leak or it should not crash.



1ï¸âƒ£ First Principle: App scales easily, DB does NOT

API servers â†’ stateless â†’ easy horizontal scaling
SQL Database â†’ stateful â†’ hard to scale

So the goal is:
   Reduce load on the database and make each DB call cheaper


2ï¸âƒ£ Absolute MUST-HAVES (Before Anything Else)
âœ… Connection Pooling (Non-Negotiable)

If not handled properly, this alone can:

Cause timeouts
Look like memory leaks
Crash the database


â€¢ Use one connection per request
â€¢ Always open late, close early
â€¢ Never store DbConnection as a singleton


max Pool Size=100; Min Pool Size=10
ğŸ”´ Symptom of pool exhaustion: API is fast but randomly times out under load


3ï¸âƒ£ Query & Index Optimization (Biggest DB Win)

âŒ Common mistakes

SELECT *
Missing indexes
Queries inside loops (N+1 problem)
No execution plan analysis


4ï¸âƒ£ Read Scaling: Separate Reads from Writes

Most APIs are read-heavy.

ğŸ”¹ Read Replicas (Azure SQL Read Scale-Out)

One primary (write)
Multiple read-only replicas
Route:
 GET â†’ replica
 POST/PUT â†’ primary


5ï¸âƒ£ Caching: The Real Game Changer ğŸš€

| Type                | Use Case           |
| ------------------- | ------------------ |
| In-memory           | Small, short-lived |
| Distributed (Redis) | Scaled APIs        |
| HTTP caching        | Public GET APIs    |



6ï¸âƒ£ Command/Query Separation (CQRS-lite)

Split responsibilities:
 Commands â†’ DB
 Queries â†’ Cache / Read Replica
 

7ï¸âƒ£ Database-Level Scaling Options (When Traffic Explodes)
ğŸ”¹ Vertical Scaling

Bigger DTU / vCore
Fastest short-term fix

ğŸ”¹ Horizontal Scaling
| Option        | When                |
| ------------- | ------------------- |
| Sharding      | Very large datasets |
| Elastic Pools | Multiple DBs        |
| Partitioning  | Large tables        |



ğŸ”Ÿ Protection Mechanisms (Prevent DB Crash)
Rate Limiting

Avoid sudden DB overload
Implement at API Gateway / APIM
Circuit Breaker
Fail fast instead of killing DB

CommandTimeout = 30 seconds

--------------------------------------------------------------------------------


Q ADO.NET and Entity Framework Core, which one handles connection polling in most efficient way?

Both ADO.NET and Entity Framework Core use the same connection pool, so neither is inherently more 
efficient at connection pooling.

EF Core â†’ Built on top of ADO.NET â†’ Uses the same pool

Then Why Does EF Core Sometimes Feel Slower?
  Because pooling efficiency â‰  overall DB efficiency.
  
  
EF Core adds overhead in:  

| Area                             | Impact                 |
| -------------------------------- | ---------------------- |
| Change Tracking                  | More memory & CPU      |
| Object materialization           | Slower than raw reader |
| LINQ translation                 | Query compilation cost |
| DbContext lifetime mismanagement | Pool exhaustion        |


--------------------------------------------------------------------------------


Q What is n+1 problem in EF Core?

The N+1 problem in EF Core is a very common performance issue that happens when EF Core executes one query to 
load a parent entity and then one additional query per child entity.


class Order
{
    public int Id { get; set; }
    public ICollection<OrderItem> Items { get; set; }
}

Problematic Code âŒ
var orders = context.Orders.ToList(); // 1 query

foreach (var order in orders)
{
    Console.WriteLine(order.Items.Count); // N queries
}

SQL executed
SELECT * FROM Orders;        -- 1 query
SELECT * FROM OrderItems WHERE OrderId = 1;
SELECT * FROM OrderItems WHERE OrderId = 2;
SELECT * FROM OrderItems WHERE OrderId = 3;
-- ... N queries



How to Fix N+1 Problem

1ï¸âƒ£ Eager Loading (Most Common Fix) âœ…

var orders = context.Orders
    .Include(o => o.Items)
    .ToList();


2ï¸âƒ£ Projection (Best Performance) ğŸš€
var orders = context.Orders
    .Select(o => new
    {
        o.Id,
        ItemCount = o.Items.Count
    })
    .ToList();
	
	
3ï¸âƒ£ Disable Lazy Loading

Lazy loading causes N+1 by default.

services.AddDbContext<AppDbContext>(options =>
    options.UseLazyLoadingProxies(false));


-------------------------------------------------------------
	
Q what is Object materialization  in EF Core?

Object Materialization is the process of converting raw database result sets (rows and columns) into C# objects (entities).


// 1. Build query (no execution)
IQueryable<Policy> query = dbContext.Policies
    .Where(p => p.IsActive)
    .Include(p => p.Customer);

// 2. Trigger execution (materialization starts)
var policies = query.ToList();
```

**What EF Core does during materialization:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Expression Tree Translation                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ LINQ Expression â†’ SQL Query                                 â”‚
â”‚ .Where(p => p.IsActive) â†’ WHERE IsActive = 1               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Database Execution                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Execute SQL: SELECT * FROM Policies WHERE IsActive = 1     â”‚
â”‚ Returns: DataReader with raw rows                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Object Materialization                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ For each row:                                               â”‚
â”‚   1. Create new Policy()                                    â”‚
â”‚   2. Set Id = row["Id"]                                     â”‚
â”‚   3. Set PolicyNumber = row["PolicyNumber"]                 â”‚
â”‚   4. Set IsActive = row["IsActive"]                         â”‚
â”‚   5. Create related Customer() if included                  â”‚
â”‚   6. Add to Change Tracker                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Return Materialized Objects                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Return List<Policy> with fully populated objects            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜



----------------------------------------------------------------


Q What is JWT ?

JWT (JSON Web Token) is a compact, self-contained token used to securely transmit information between parties, 
most commonly for authentication and authorization in APIs.


JWT is a signed token that proves who the user is and what they are allowed to access, 
without storing session state on the server.



Why JWT Exists

Traditional session-based auth:
Server stores session in memory / DB
Hard to scale horizontally




-----------------------------------------------------------------

Q In OAuth2, what is the difference between Authorization Code Flow and OIDC?

Authorization Code Flow and OIDC are not competing things.
One is an OAuth 2.0 flow, the other is an identity layer built on OAuth 2.0.

| Concept                     | What it does                                            |
| --------------------------- | ------------------------------------------------------- |
| **Authorization Code Flow** | **Gets access tokens** â†’ â€œCan this app access the API?â€ |
| **OIDC (OpenID Connect)**   | **Adds identity** â†’ â€œWho is the user?â€                  |


1ï¸âƒ£ Authorization Code Flow (OAuth 2.0)

A secure OAuth 2.0 flow used to obtain:

access_token
(optionally) refresh_token

User â†’ Login page
App â†’ Authorization Server
â† Authorization Code
App â†’ Token Endpoint
â† Access Token


âŒ OAuth does NOT tell you who the user is
âœ” It only tells you what the app can access



2ï¸âƒ£ OpenID Connect (OIDC)

It uses the Authorization Code Flow, but adds:
id_token
User identity claims

| Token         | OAuth 2.0 | OIDC |
| ------------- | --------- | ---- |
| Access Token  | âœ…         | âœ…    |
| Refresh Token | âœ…         | âœ…    |
| **ID Token**  | âŒ         | âœ…    |


| Aspect        | Authorization Code Flow | OIDC                           |
| ------------- | ----------------------- | ------------------------------ |
| Spec          | OAuth 2.0               | OAuth 2.0 + Identity           |
| Purpose       | Authorization           | Authentication + Authorization |
| User identity | âŒ No                    | âœ… Yes                          |
| ID Token      | âŒ                       | âœ…                              |
| Scopes        | api scopes              | openid, profile, email         |
| Common use    | API access              | Login + SSO                    |



----------------------------------------------------------------

Q explain SAML. Is it for authorization or for authentication ?

SAML (Security Assertion Markup Language) is an open standard for exchanging authentication and
 authorization data between parties, specifically between:

Identity Provider (IdP) - Who you are (authentication)
Service Provider (SP) - What you can access (authorization)

XML-based protocol used primarily for Single Sign-On (SSO).


SAML is primarily for AUTHENTICATION âœ…
But it can also carry authorization information (roles, permissions) âœ…


SAML Components
1. Identity Provider (IdP)
What it does: Authenticates users and issues SAML assertions
Examples:

Okta
Azure Active Directory (Azure AD)
Google Workspace
Auth0
ADFS (Active Directory Federation Services)
OneLogin
Ping Identity

2. Service Provider (SP)
What it does: Consumes SAML assertions to grant access
Examples:

Salesforce
Slack
AWS Console
GitHub Enterprise
Your Insurance API/Portal

3. SAML Assertion
What it is: An XML document that contains authentication and authorization information


`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: User Accesses Service Provider                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User â†’ https://insurance.company.com/dashboard               â”‚
â”‚ SP: "You're not authenticated. I'll redirect you to IdP."   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: SP Generates SAML AuthnRequest                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SP creates SAML request (XML) asking IdP to authenticate     â”‚
â”‚ user. Redirects browser to IdP with this request.            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: User Redirected to IdP Login Page                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Browser â†’ https://idp.company.com/login                      â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚ â”‚  Company Login                  â”‚                         â”‚
â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚                         â”‚
â”‚ â”‚  Username: [john.doe@company.comâ”‚                         â”‚
â”‚ â”‚  Password: [â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢]   â”‚                         â”‚
â”‚ â”‚  [Sign In]                      â”‚                         â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: IdP Authenticates User                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Verifies username/password                                 â”‚
â”‚ - May require MFA (2FA)                                      â”‚
â”‚ - Checks user exists in directory                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: IdP Creates SAML Assertion                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Generates SAML Response (XML)                              â”‚
â”‚ - Includes user identity, roles, attributes                  â”‚
â”‚ - Signs with private key (digital signature)                 â”‚
â”‚ - Encodes in Base64                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Browser Redirected Back to SP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ POST to: https://insurance.company.com/saml/acs              â”‚
â”‚ Body: SAMLResponse=<base64 encoded assertion>                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: SP Validates SAML Assertion                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Verify digital signature (using IdP's public certificate)  â”‚
â”‚ - Check assertion not expired                                â”‚
â”‚ - Verify audience matches (assertion for this SP)            â”‚
â”‚ - Extract user info (email, roles, permissions)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 8: SP Creates User Session                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - Create session cookie                                      â”‚
â”‚ - Store user identity in session                             â”‚
â”‚ - Grant access to application                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 9: User Logged In!                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ User sees dashboard at insurance.company.com                 â”‚
â”‚ âœ… Authenticated                                             â”‚
â”‚ âœ… Session established                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Authorization (Secondary Use) âœ…
SAML can carry authorization data via attributes:

--------------------------------------------------------------------

Q What is difference between database partioning and sharding?

1ï¸âƒ£ Partitioning

What it is

Dividing one large table into smaller logical parts
Same database, same server
Application does not know partitions exist

Orders table
â†’ Orders_2023
â†’ Orders_2024
â†’ Orders_2025


2ï¸âƒ£ Sharding

What it is
Splitting data across multiple databases / servers
Each shard has its own database
Application must know shard logic

Users Aâ€“M â†’ DB1
Users Nâ€“Z â†’ DB2


| Aspect         | Partitioning | Sharding    |
| -------------- | ------------ | ----------- |
| Database count | One          | Multiple    |
| Server count   | One          | Many        |
| App awareness  | âŒ No         | âœ… Yes       |
| Scaling type   | Vertical     | Horizontal  |
| Complexity     | Low          | High        |
| Cross-query    | Easy         | Hard        |
| Failure impact | DB-level     | Shard-level |


--------------------------------------------------


Q What is connection Pooling ?

Connection pooling means reusing open database connections from a pool 
instead of opening and closing a new connection every time. 


Why Connection Pooling Exists

Opening a database connection is expensive:
Network handshake
Authentication
Session setup
Memory allocation

Doing this for every API request would:
Slow down responses
Exhaust DB resources
Cause timeouts under load


Step-by-step

App asks for a DB connection
Pool checks:
 âœ… Free connection available â†’ reuse it
 âŒ None available â†’ create a new one (up to max limit)
App uses the connection
App calls Close() / Dispose()
Connection goes back to the pool, not to the DB
âš ï¸ Close() does NOT close the physical connection â€” it returns it to the pool



------------------------------------------------------------------------

Q Server=.;Database=AppDb; User Id=app;Password=***;Max Pool Size=100;Min Pool Size=10;

Let's says at a same time 100 request comes to db . All 100 connection will be used. Will 101th request will fail.  
Also explain min pool size 


1ï¸âƒ£ What Happens When 100 Requests Hit at the Same Time?
Step-by-step timeline
ğŸ”¹ Application start

Pool is created lazily

Min Pool Size = 10
â†’ 10 physical connections are opened and kept ready



ğŸ”¹ Requests 1 â†’ 10
Use the pre-created 10 connections
No new connections created
Very fast

ğŸ”¹ Requests 11 â†’ 100
Pool grows dynamically
New connections are created
At request #100:
Total connections = 100
Pool is now FULL


2ï¸âƒ£ What Happens to the 101st Request?

âŒ It does NOT fail immediately

101st request
â†’ waits for a free connection
â†’ up to Connection Timeout (default: 15 seconds)

| Case                              | Result            |
| --------------------------------- | ----------------- |
| A connection frees within timeout | Request succeeds  |
| No connection frees               | Timeout exception |


3ï¸âƒ£ What Exactly Is Min Pool Size?
Definition

Minimum number of physical connections the pool maintains at all times


-------------------------------------------------------------------


Q Let's say I have two completely different applications which are using same database. 
How min and max pool connection will be handled? Is it at database level or at application level?


Connection pooling is handled at the application (process) level, NOT at the database level.


Role of the Database (SQL Server / Azure SQL)

The database:
Does not know about pools

Just sees:
Sessions
Logins
Active connections

It only enforces:
Max allowed connections
CPU / memory / IO limits


--------------------------------------------------------------

Q In my application, I have just mentioned the connection string. That's it. Then how to get max and min pool size?

If you do not specify Min Pool Size and Max Pool Size, ADO.NET uses default values.

| Setting            | Default Value |
| ------------------ | ------------- |
| Pooling            | `true`        |
| **Max Pool Size**  | **100**       |
| **Min Pool Size**  | **0**         |
| Connection Timeout | 15 seconds    |



--------------------------------------------------------------------------


Q ingress vs loadBalancer type service in k8s ?

LoadBalancer is a Service type that exposes ONE service externally.
Ingress is a smart HTTP/HTTPS router that exposes MANY services using ONE load balancer.


LoadBalancer:
Pros

âœ” Simple
âœ” No extra components
âœ” Good for quick exposure

Cons ğŸš¨

âŒ One LB per service (expensive)
âŒ No path-based routing
âŒ Limited TLS control


Ingress:
What it is

NOT a Service

A routing layer (Layer 7 â€“ HTTP/HTTPS)

Works with an Ingress Controller (NGINX, Traefik, etc.)

Ingress uses:

ONE LoadBalancer

Routes traffic to multiple ClusterIP services


| Feature           | LoadBalancer Service | Ingress               |
| ----------------- | -------------------- | --------------------- |
| Kubernetes object | Service              | Ingress               |
| Layer             | L4 (TCP/UDP)         | L7 (HTTP/HTTPS)       |
| Public IPs        | One per service      | One for many services |
| Routing           | No                   | Path / host based     |
| TLS termination   | Basic                | Advanced              |
| Cost              | High                 | Low                   |
| Scalability       | Poor                 | Excellent             |



---------------------------------------------------

Q what is tls termination ?

TLS termination means decrypting HTTPS (TLS) traffic at a specific point so that downstream traffic
 can be forwarded as plain HTTP or re-encrypted again.
 
 
----------------------------

Q TLS vs SSL?

SSL is deprecated and insecure.
TLS is the modern, secure replacement that everyone uses today.



------------------------------------------

Q Deprecated and obsolete attributes in .NET ?

1ï¸âƒ£ Deprecated (Concept / Documentation Level)
What it means

The API still works

Microsoft recommends not using it

Usually mentioned in:

Docs

Release notes

Comments

Important

âŒ .NET has NO Deprecated keyword
âœ” â€œDeprecatedâ€ is a concept, not a compiler feature


2ï¸âƒ£ Obsolete (Actual .NET / C# Feature)
What it means

The API is explicitly marked using [Obsolete]

Compiler warns or errors

Enforced at compile time


[Obsolete("Use NewMethod instead")]  # waring 
public void OldMethod()
{
}


[Obsolete("Do not use this method", true)] # Error
public void OldMethod()
{
} 


------------------------------------------------------------------

Q How to use Offest in sql server?

OFFSET n ROWS means:

Skip the first n rows of the ordered result sets


SELECT Id, Name, Salary
FROM Employees
OFFSET 0 ROWS FETCH NEXT 1000 ROWS ONLY;

SELECT Id, Name, Salary
FROM Employees
OFFSET 1000 ROWS FETCH NEXT 1000 ROWS ONLY;

SELECT Id, Name, Salary
FROM Employees
OFFSET 2000 ROWS FETCH NEXT 1000 ROWS ONLY;




------------------------------------------------------------------

Q I want to design an API that will return 10 millions of records, how should I design it?

1 Use cursor based pagination

GET /api/orders?cursor=eyJpZCI6MTAwMH0=&limit=1000

Why cursor-based pagination?

Works well for large datasets
Avoids OFFSET performance issues
Stable even when data changes

SELECT *
FROM Orders
WHERE Id > @LastSeenId
ORDER BY Id
LIMIT @PageSize;



2. Streaming Response (When Client Must Read Everything)

If the client truly needs all 10M records, stream them instead of buffering.

Options

HTTP chunked transfer

IAsyncEnumerable<T> in ASP.NET Core

gRPC streaming


[HttpGet]
public async IAsyncEnumerable<Order> GetOrders()
{
    await foreach (var order in _repo.StreamOrders())
    {
        yield return order;
    }
}


3 Filtering + Projection (Reduce Payload Size)


4. Database Considerations

For 10M+ rows:

Use covering indexes

Avoid OFFSET

Stream data from DB (data reader)

Consider read replicas



---------------------------------------------------------------

Q What is covering index?

A covering index is an index that contains all the columns required by a query, so the database engine can satisfy 
the query entirely from the index without going back to the base table


1ï¸âƒ£ Why covering indexes matter

Without a covering index:

SQL Server uses Index Seek/Scan
Then performs Key Lookup for each matching row
Performance degrades badly with many rows

With a covering index:

Query is resolved only from the index
Fewer I/O operations
Much faster execution


CREATE INDEX IX_Employees_Pagination
ON Employees(DepartmentId, Id)
INCLUDE (Name, Salary);


SELECT Id, Name, Salary
FROM Employees
WHERE DepartmentId = @DeptId
  AND Id > @LastId
ORDER BY Id
OFFSET 0 ROWS FETCH NEXT 1000 ROWS ONLY;



Note : columns in INCLUDE cannot be used in WHERE clause.

-------------------------------------------------------------------------


Q What is idempotency


Idempotency = multiple identical requests â†’ same result

Calling the same operation multiple times produces the same result as calling it once.

DELETE /users/123

Call once â†’ user deleted

Call again â†’ user already deleted

Result is the same âœ”

Non-idempotent operation:
POST /orders

| Method | Idempotent? | Reason                    |
| ------ | ----------- | ------------------------- |
| GET    | âœ…           | Read-only                 |
| PUT    | âœ…           | Replaces resource         |
| DELETE | âœ…           | Removes resource          |
| POST   | âŒ           | Creates new resource      |
| PATCH  | âš ï¸          | Depends on implementation |



---------------------------------------------------------

Q what is mean by anti pattern?

An anti-pattern is a commonly used solution that looks right at first, but actually causes more problems than it solves in the long run.

Think of it as:

âŒ â€œThis worksâ€¦ but itâ€™s the wrong way.â€


-------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------

Q How would you design a REST API to handle millions of requests per day?

Stateless APIs (no server-side session)

Horizontal scaling (multiple instances behind load balancer)

Proper indexing at DB level

Caching (CDN + Redis)

Async processing for heavy tasks

Rate limiting & throttling

Use API Gateway

Observability (logs, metrics, traces)


-------------------------------------------------------------------------------------------------------------


Q How do you decide between REST, GraphQL, and gRPC?

REST â†’ Public APIs, simple CRUD, browser-friendly

GraphQL â†’ Client-driven queries, avoid over/under-fetching

gRPC â†’ Internal microservices, low latency, high throughput


---------------------------------------------------------------------------------------

Q How would you version an API without breaking clients?

Preferred approaches:

URL versioning â†’ /api/v1/orders

Header-based â†’ Accept: application/vnd.app.v1+json

Best practices:

Never break existing contracts

Deprecate gradually

Support multiple versions temporarily


-------------------------------------------------------------------------------------------------


Q Offset vs Cursor-based pagination?

| Offset                    | Cursor      |
| ------------------------- | ----------- |
| Simple                    | Scales well |
| Slow for large data       | Fast        |
| Inconsistent with inserts | Stable      |

ğŸ‘‰ Cursor-based is preferred at scale

------------------------------------------------------------------

How would you design rate limiting?


Techniques:

Token Bucket
Leaky Bucket
Fixed window

Implementation:

Redis / API Gateway
Per IP / user / API key
Return 429 Too Many Requests


----------------------------------------------------------------

Q How do you cache API responses?

Caching layers:

Browser cache
CDN (CloudFront)
Server cache (Redis)
Database cache

Rules:

Cache GETs
Use TTL
Cache invalidation on updates


---------------------------------------------------------------------

Q  How do you reduce API latency globally?

CDN

Geo-replication

Read replicas

Async APIs

Compression (gzip)

Minimize payload size


-------------------------------------------------------------------------


Q What is Bulkheads pattern?

Bulkhead is a resilience pattern used to isolate failures so that a problem in one part of the system does 
not bring down the entire application.


âŒ Without Bulkheads (Bad Scenario)

Service A
 â”œâ”€â”€ Feature X
 â”œâ”€â”€ Feature Y
 â””â”€â”€ Feature Z
        â†“
   Calls Slow Service
        â†“
   Threads exhausted
        â†“
   Entire API DOWN âŒ



âœ… With Bulkheads (Good Scenario)

Service A
 â”œâ”€â”€ Feature X â†’ Thread Pool A
 â”œâ”€â”€ Feature Y â†’ Thread Pool B
 â””â”€â”€ Feature Z â†’ Thread Pool C

Feature Z fails âŒ

Feature X & Y still work âœ…

Partial failure, not total outage



ğŸ§  Types of Bulkheads

1ï¸âƒ£ Thread Pool Bulkhead

Separate thread pools per dependency.

Example

Payments â†’ 20 threads

Orders â†’ 30 threads

Notifications â†’ 10 threads


2ï¸âƒ£ Connection Pool Bulkhead

Separate DB or HTTP connection pools.

Example

Reporting DB pool (heavy queries)

Transaction DB pool (critical queries)

Reporting overload wonâ€™t kill transactions.


3ï¸âƒ£ Instance-Level Bulkhead

Deploy different workloads as separate services or pods.



âš™ï¸ Bulkheads in Real Systems
In Microservices

Separate services
Separate Kubernetes pods
Separate HPA scaling rules

In .NET

Separate HttpClient instances
Different connection pools
Limited Task concurrency
Polly Bulkhead Policy




-------------------------------------------------------------------------------------------


Q How to design bulkhead in .NET?


ğŸ”¹ Option 1: Bulkheads Using Polly (BEST PRACTICE)

dotnet add package Polly



using Polly;
using Polly.Bulkhead;

public static class BulkheadPolicies
{
    public static AsyncBulkheadPolicy FeatureXPolicy =
        Policy.BulkheadAsync(
            maxParallelization: 20,
            maxQueuingActions: 50);

    public static AsyncBulkheadPolicy FeatureYPolicy =
        Policy.BulkheadAsync(
            maxParallelization: 10,
            maxQueuingActions: 30);

    public static AsyncBulkheadPolicy FeatureZPolicy =
        Policy.BulkheadAsync(
            maxParallelization: 5,
            maxQueuingActions: 10);
}




public class FeatureXService
{
    public async Task ExecuteAsync()
    {
        await BulkheadPolicies.FeatureXPolicy.ExecuteAsync(async () =>
        {
            // Call downstream service or heavy operation
            await Task.Delay(100);
        });
    }
}


public class FeatureYService
{
    public async Task ExecuteAsync()
    {
        await BulkheadPolicies.FeatureYPolicy.ExecuteAsync(async () =>
        {
            // Call downstream service or heavy operation
            await Task.Delay(100);
        });
    }
}


public class FeatureZService
{
    public async Task ExecuteAsync()
    {
        await BulkheadPolicies.FeatureZPolicy.ExecuteAsync(async () =>
        {
            // Call downstream service or heavy operation
            await Task.Delay(100);
        });
    }
}




ğŸ”¹ Option 2: Bulkheads Using IHttpClientFactory (VERY COMMON)


1ï¸âƒ£ Register HttpClients with Bulkheads


builder.Services.AddHttpClient("FeatureXClient")
    .AddPolicyHandler(Policy.BulkheadAsync(20, 50));

builder.Services.AddHttpClient("FeatureYClient")
    .AddPolicyHandler(Policy.BulkheadAsync(10, 30));

builder.Services.AddHttpClient("FeatureZClient")
    .AddPolicyHandler(Policy.BulkheadAsync(5, 10));

Note:
Policy.BulkheadAsync(
    maxParallelization: 20,
    maxQueuingActions: 50
)

1ï¸âƒ£ maxParallelization = 20

At most 20 concurrent executions are allowed
These are the â€œactive workersâ€

2ï¸âƒ£ maxQueuingActions = 50

Additional requests (beyond 20) are placed into a queue
Maximum 50 requests can wait

ğŸš¨ What happens after that?

If 20 are running and 50 are waiting
The 71st request is rejected immediately
Polly throws a BulkheadRejectedException


2ï¸âƒ£ Use Named Clients



public class FeatureYService
{
    private readonly HttpClient _client;

    public FeatureYService(IHttpClientFactory factory)
    {
        _client = factory.CreateClient("FeatureYClient");
    }

    public async Task CallAsync()
    {
        await _client.GetAsync("https://downstream/api");
    }
}


---------------------------------------------------------


Q  How do you design fault-tolerant APIs?

Timeouts

Retries with backoff

Circuit breakers

Graceful degradation

Bulkheads



----------------------------------------------------------------


Q What if a dependent service is down?

Answer:

Return cached data

Fallback responses

Async processing

Partial responses

Circuit breaker open state


----------------------------------------------

Q  How do you implement retries safely?

Retry only idempotent APIs

Exponential backoff

Max retry limit



-------------------------------------------------


Q Handling traffic spikes?

Auto-scaling

Rate limiting

Queue-based buffering

Read replicas

Feature throttling


-----------------------------------------------------

Q  How do you secure APIs?


HTTPS everywhere

Input validation

Rate limiting

WAF

Token signing

Replay protection (nonce, timestamp)


-----------------------------------------------------------------

Q  How do you design centralized observability?

Centralized logging (ELK)

Metrics (Prometheus)

Distributed tracing (OpenTelemetry)

Correlation IDs


------------------------------------------------------------------


Q  How do you debug production performance issues?


Latency percentiles (P95, P99)

Slow query logs (use Query Execution plans)

Traces across services

Compare before/after deployments



------------------------------------------------------------


Q  How do you design zero-downtime deployments?

Answer:

Blue-green deployment
Canary releases



---------------------------------------------------------------------

Q Optimistic vs Pessimistic Concurrency?

ğŸŸ¢ Optimistic Concurrency Control (OCC)
ğŸ” Idea

Assume conflicts are rare.
Allow multiple transactions to read/update data without locking, and detect conflicts at commit time.


ğŸ”§ How It Works

Read data

Remember a version (timestamp / rowversion)

Update with a condition:

example

UPDATE Products
SET Price = 120
WHERE Id = 1 AND RowVersion = 0x00000000000007D3;

If another transaction updated the row first â†’ update fails.

âœ… Pros

No locks â†’ high performance
Better scalability
Ideal for web APIs

âŒ Cons

Conflicts detected late
Requires retry logic



ğŸ”´ Pessimistic Concurrency Control (PCC)
ğŸ” Idea

Assume conflicts are common.
Lock data immediately so others must wait.


ğŸ”§ How It Works

Row/table locks

Other transactions block until lock released


SELECT *
FROM Products WITH (UPDLOCK, ROWLOCK)
WHERE Id = 1;




| Feature           | Optimistic | Pessimistic |
| ----------------- | ---------- | ----------- |
| Locking           | âŒ No locks | âœ… Locks     |
| Conflict handling | At commit  | At read     |
| Performance       | â­ High     | âŒ Lower     |
| Scalability       | â­ High     | âŒ Limited   |
| Deadlocks         | âŒ No       | âš ï¸ Possible |
| Retry logic       | Required   | Not needed  |


-------------------------------------------------------------

Q  How to handle concurrency in EF Core?


1ï¸âƒ£ Add RowVersion Column (SQL Server)
ALTER TABLE Products
ADD RowVersion ROWVERSION;



2ï¸âƒ£ Configure Entity


public class Product
{
    public int Id { get; set; }
    public string Name { get; set; }
    public decimal Price { get; set; }

    [Timestamp]
    public byte[] RowVersion { get; set; }
}



or Fluent API:


modelBuilder.Entity<Product>()
    .Property(p => p.RowVersion)
    .IsRowVersion();



try
{
    await context.SaveChangesAsync();
}
catch (DbUpdateConcurrencyException ex) # imp
{
    // Someone else modified the row
    throw new Exception("Data was modified by another user. Please retry.");
}



----------------------------------------------------------------------


Q resilience vs reliability ?


ğŸ”µ Reliability
ğŸ“Œ Definition

Reliability is the ability of a system to work correctly without failure for a long period of time.

ğŸ‘‰ Focus: Preventing failures



ğŸŸ¢ Resilience
ğŸ“Œ Definition

Resilience is the ability of a system to handle failures gracefully and recover quickly.

ğŸ‘‰ Focus: Surviving failures


--------------------------------------------------------------------------

Q  common, real-world reasons why a Pod can die or crash in a microservices (Kubernetes) environment ?

1ï¸âƒ£ Out Of Memory (OOMKilled)
What happens

Pod exceeds its memory limit
Linux kernel kills the container


Fix

Increase memory limits
Use proper autoscaling


2ï¸âƒ£ CPU Throttling / Starvation

What happens

Pod hits CPU limits
Requests slow â†’ timeouts â†’ crashes

Fix

Increase CPU limits
Optimize code
Avoid blocking threads


3ï¸âƒ£ Liveness Probe Failure
What happens

App responds slowly or incorrectly
Kubernetes thinks pod is unhealthy
Pod is restarted



4ï¸âƒ£ Application Crash (Unhandled Exception)
What happens

App throws exception

Process exits

Container exits â†’ pod restarts


Fix

Proper exception handling
Validate configs on startup


5ï¸âƒ£ CrashLoopBackOff
What happens

Pod crashes repeatedly
Kubernetes backs off restart attempts


6ï¸âƒ£ Node Failure
What happens

Node goes down

All pods on that node are lost


7ï¸âƒ£ Image Pull Failure
What happens

Image not found

Registry authentication failure


8ï¸âƒ£ ConfigMap / Secret Issues
What happens

Missing config

App fails on startup



9 Disk Pressure / Ephemeral Storage Exhaustion
What happens

Logs or temp files fill disk

Node evicts pods

Pod status

Evicted


--------------------------------------------------------------------------------------

Q What is mean by Liveness probe failure and Readyness probe failure in kubernetes ?

In Kubernetes, liveness and readiness probes are health checks used by the kubelet to manage your pods.

ğŸ” Liveness Probe Failure

A liveness probe failure means:

â€œThe container is running, but it is stuck or unhealthy and will not recover on its own.â€

What Kubernetes does

Kills the container
Restarts it automatically (based on restart policy)

Why it exists

To recover from situations like:
Deadlocks
Infinite loops
Application stuck but process still alive
Memory leak causing app freeze

Real-world analogy

Your app is like a hung process â†’ turning it OFF and ON fixes it.


ğŸš¦ Readiness Probe Failure

A readiness probe failure means:

â€œThe container is alive, but not ready to serve traffic right now.â€

What Kubernetes does

Stops sending traffic to the pod
Does NOT restart the container


Why it exists

To protect users during:

Startup warm-up
Dependency failures (DB, cache down)
Heavy load / throttling
Rolling deployments


Real-world analogy

Restaurant is open but kitchen is overloaded â†’ stop accepting new orders.


livenessProbe:
  httpGet:
    path: /health/live
    port: 8080

readinessProbe:
  httpGet:
    path: /health/ready
    port: 8080


ğŸ§  One-Line Summary

Liveness failure â†’ â€œKill and restart the containerâ€

Readiness failure â†’ â€œStop sending trafficâ€


----------------------------------------------------------------------------------------


Q What is mean by CI/CD ?

CI/CD stands for Continuous Integration and Continuous Delivery (or Continuous Deployment).


ğŸ” CI â€” Continuous Integration

Meaning: Developers frequently merge their code into a shared repository, and every change is automatically built and tested.


ğŸš€ CD â€” Continuous Delivery / Continuous Deployment

Continuous Delivery

Meaning: Code is always deployable, but deployment to production requires manual approval.

Continuous Deployment

Meaning: Every successful change is automatically deployed to production (no manual approval).


-------------------------------------------------------------------------------------


Q Api gateway vs load balancer?

ğŸ” Load Balancer

What it is

A Load Balancer distributes incoming traffic across multiple backend servers or pods.
Main responsibility
   â€œDistribute traffic evenly and keep services available.â€
   
   
What it does well

  Traffic distribution (round-robin, least connections)
  Health checks
  Failover
  High availability
  SSL/TLS termination

What it does NOT do

  Authentication / Authorization
  Rate limiting
  Request transformation
  API versioning   
  
Example

  AWS Application Load Balancer
  NGINX
  HAProxy  
  
  
ğŸšª API Gateway
What it is

An API Gateway is a single entry point for all client requests in a microservices architecture/ application.  

Main responsibility

â€œControl, secure, and manage APIs.â€


What it does well

  Authentication & authorization (JWT, OAuth)
  Rate limiting & throttling
  Request/response transformation
  API versioning
  Logging & monitoring
  Routing to correct microservice
  

What it does NOT focus on

  Advanced traffic distribution algorithms
  Low-level network load balancing  
  
  
Example:
Azure API Management

----------------------------------------------------

Q Method hiding.


-----------------------------------------


Q What is service principle



-----------------------------------------------------

Q What is service mesh in Microservices?



----------------------------------------------------


Q New .net features


-----------------------------------------------


